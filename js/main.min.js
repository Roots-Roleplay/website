const HERO_RANDOM_MAX_STEPS=12,DESIGN_WIDTH=2560,DESIGN_HEIGHT=1440;function applyViewportScaling(){if(window.innerWidth<1024)return document.body.style.transform="",document.body.style.width="",document.body.style.height="",void document.body.classList.remove("desktop-scaled");const e=window.innerWidth,t=window.innerHeight;let a;a=e/t>2560/1440?e/2560:t/1440,document.body.style.width="2560px",document.body.style.height="1440px",document.body.style.transform=`scale(${a})`,document.body.style.transformOrigin="top left",document.body.classList.add("desktop-scaled"),document.documentElement.style.setProperty("--viewport-scale",a),document.documentElement.style.setProperty("--viewport-width",`${e}px`),document.documentElement.style.setProperty("--viewport-height",`${t}px`)}const checkMobile=()=>{const e=document.getElementById("mobileOverlay");if(!e)return;const t=window.innerWidth<1024;e.style.display=t?"flex":"none",t&&(document.body.style.overflow="hidden")};let viewportResizeRaf=null;function handleViewportResize(){null===viewportResizeRaf&&(viewportResizeRaf=requestAnimationFrame(()=>{checkMobile(),applyViewportScaling(),viewportResizeRaf=null}))}function exitSplitMode(){const e=state.currentCategory;renderHeroCards(getDataset(e),e),document.body.classList.remove("is-split-open")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{checkMobile(),applyViewportScaling()}):(checkMobile(),applyViewportScaling()),window.addEventListener("resize",handleViewportResize,{passive:!0}),window.addEventListener("orientationchange",()=>{requestAnimationFrame(()=>{checkMobile(),applyViewportScaling(),"function"==typeof handleResize&&handleResize()})},{passive:!0});const state={companies:[],crimeFactions:[],nogos:[],whitelist:[],currentCategory:"legal",currentIndex:0,heroCardsMounted:!1,heroRailDragging:{active:!1,startX:0,scrollLeft:0,moved:!1,blockClickUntil:0},heroControlsInit:!1,heroRandomCooldown:!1,heroRandomSpinTimeouts:[],youtubeReady:!1,youtubeInitQueue:[],detailVideo:null,railIdleTimer:null,railAutoTimer:null},CATEGORY_CONFIG={legal:{getDataset:()=>state.companies,getTitle:e=>{const{titleMain:t,fallback:a}=parseCompanyTitleParts(e.title,e.displayName||e.id);return t||a},getTagline:e=>{const{tagline:t}=parseCompanyTitleParts(e.title,e.displayName||"");return t||""},getContent:e=>e.description||"",getMedia:e=>extractVideoMedia(e)||extractImageMedia(e,e.displayName||e.title||"Visual"),buildCollage:buildCompanyCollage},illegal:{getDataset:()=>state.crimeFactions,getTitle:e=>e.title||e.id,getTagline:e=>e.tagline||"",getContent:e=>e.content||"",getMedia:e=>extractVideoMedia(e)||extractImageMedia(e,e.title||"Crew"),buildCollage:buildCrimeCollage},regelwerk:{getDataset:()=>state.nogos,getTitle:e=>e.title||e.id,getTagline:e=>e.tagline||"",getContent:e=>e.content||"",getMedia:e=>getSimpleImageMedia(e,"Regelwerk"),buildCollage:buildRegelwerkCollage},whitelist:{getDataset:()=>state.whitelist,getTitle:e=>e.title||e.id,getTagline:e=>e.tagline||"",getContent:e=>e.content||"",getMedia:e=>getSimpleImageMedia(e,"Whitelist"),buildCollage:buildWhitelistCollage}},COLLAGE_LAYOUTS=[[{x:-8,y:-10,w:44,h:34,r:-9},{x:34,y:-6,w:40,h:30,r:7},{x:76,y:-2,w:34,h:28,r:-5},{x:4,y:32,w:38,h:32,r:11},{x:44,y:30,w:36,h:32,r:-6},{x:84,y:30,w:32,h:30,r:12},{x:16,y:66,w:38,h:32,r:-7},{x:54,y:64,w:32,h:30,r:6},{x:-6,y:64,w:30,h:30,r:3},{x:80,y:66,w:34,h:34,r:-11}],[{x:-6,y:-8,w:42,h:32,r:-8},{x:32,y:-10,w:44,h:31,r:9},{x:72,y:-4,w:36,h:28,r:-4},{x:2,y:34,w:34,h:30,r:8},{x:40,y:32,w:38,h:32,r:-7},{x:78,y:30,w:34,h:32,r:10},{x:12,y:68,w:36,h:32,r:-5},{x:48,y:66,w:32,h:30,r:5},{x:-4,y:68,w:30,h:30,r:1},{x:74,y:68,w:36,h:34,r:-12}]],MAX_COLLAGE_ITEMS=Math.max(...COLLAGE_LAYOUTS.map(e=>e.length)),COLLAGE_SIZE_SCALE=.79;function extractVideoMedia(e){return Array.isArray(e.videos)&&e.videos.length>0&&e.videos[0].youtubeId?{type:"video",youtubeId:e.videos[0].youtubeId,buyUrl:e.videos[0].buyUrl||e.buyUrl||null,allVideos:e.videos,videoIndex:0}:e.videoId?{type:"video",youtubeId:e.videoId,buyUrl:e.buyUrl||null,allVideos:null,videoIndex:0}:null}function extractImageMedia(e,t){return e.image?{type:"image",src:normalizeAssetPath(e.image),alt:t}:null}function getSimpleImageMedia(e,t){return extractImageMedia(e,e.title||t)}function addKeyboardSupport(e,t){e&&e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})}function createIntroImageCard(e,t){return{id:e,title:"",content:"",image:t,tagline:"",showTextLabel:!1,isIntroImageCard:!0}}function buildImageArrayFromFolder(e,t=[],a=null){const r=[];if(t.forEach(t=>{r.push(`${e}/${t}`)}),a)for(let t=a.start;t<=a.end;t++)r.push(`${e}/${t}.png`);return r}function normalizeImagePaths(e){return document.querySelector("base[href]")?e:e.map(e=>normalizeAssetPath(e))}function getRandomCharacterImages(){return normalizeImagePaths(buildImageArrayFromFolder("public/random_characters",["addad.png","afdwdar.png","agrwrq.png","awd.png","awfaqrf.png","bfd.png","csacas.png","daw.png","dwa.png","fva.png","ges.png","gse.png","hed.png","jyd.png","kitt.png","qeeweq.png","qeweqw.png","qewqe.png","qweeq.png","rhtrh.png","sffeefws.png","wad.png","waewq.png","wda.png","yk.png"],{start:1,end:100}))}function getCompanyCharacterImages(){return normalizeImagePaths(["public/company_characters/admin_character.png","public/company_characters/aldente_character.png","public/company_characters/ambulance_character.png","public/company_characters/aod_character.png","public/company_characters/bikes_character.png","public/company_characters/blockbudz_character.png","public/company_characters/burgershot_character.png","public/company_characters/caseys_character.png","public/company_characters/church_character.png","public/company_characters/doj_character.png","public/company_characters/larrys_character.png","public/company_characters/leapfrog_character.png","public/company_characters/news_character.png","public/company_characters/pearls_character.png","public/company_characters/pier76_character.png","public/company_characters/police_character.png","public/company_characters/reds_character.png","public/company_characters/sheriff_character.png","public/company_characters/smokeys_character.png","public/company_characters/taxi_character.png","public/company_characters/tuner_character.png","public/company_characters/yellowjack_character.png"])}function getCrimeCharacterImages(){return normalizeImagePaths(["public/crime_characters/aod_character.png","public/crime_characters/ballas_character.png","public/crime_characters/lost_character.png","public/crime_characters/madrazo_character.png","public/crime_characters/pit_character.png","public/crime_characters/rednecks_character.png"])}function getCrimeShuffleImages(){return normalizeImagePaths(["addad.png","afdwdar.png","agrwrq.png","awd.png","awfaqrf.png","bfd.png","csacas.png","daw.png","dwa.png","fva.png","ges.png","gse.png","hed.png","jyd.png","kitt.png","qeeweq.png","qeweqw.png","qewqe.png","qweeq.png","rhtrh.png","sffeefws.png","wad.png","waewq.png","wda.png","yk.png"].map(e=>`public/crime_shuffle/${e}`))}function getUniqueRandomImages(e,t){const a=[...e];for(let e=a.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[a[e],a[t]]=[a[t],a[e]]}return a.slice(0,Math.min(t,a.length))}function buildGuidelineGridHTML(e,t,a="Lese die Guidelines auf unserem Discord"){const r=e.slice(0,4),n=e.slice(4,5),o=e.slice(5,6),l=e.slice(6,7),i=e.slice(7,8),s=e.slice(8,10);return`\n\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t<div class="hero-card__guidelines-content">\n\t\t\t<div class="hero-card__guidelines-grid">\n\t\t\t\t${r.map((e,a)=>`<div class="hero-card__guideline-item">\n\t\t\t<img src="${e}" alt="Guideline ${a+4}" loading="lazy" ${t} class="hero-card__guideline-image">\n\t\t</div>`).join("")}\n\t\t\t\t${n.map((e,a)=>`<div class="hero-card__guideline-item" style="grid-column: 1; grid-row: 2;">\n\t\t\t<img src="${e}" alt="Guideline ${a+8}" loading="lazy" ${t} class="hero-card__guideline-image">\n\t\t</div>`).join("")}\n\t\t\t\t${`<div class="hero-card__guideline-item hero-card__guideline-item--cta" style="grid-column: 2 / 4; grid-row: 2 / 4;">\n\t\t<a href="https://discord.gg/rootsroleplay" target="_blank" rel="noopener noreferrer" class="hero-card__guidelines-discord-cta">\n\t\t\t<svg class="hero-card__discord-icon" width="32" height="32" viewBox="0 0 71 55" fill="currentColor" aria-hidden="true">\n\t\t\t\t<path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>\n\t\t\t</svg>\n\t\t\t<span class="hero-card__discord-text">${escapeHtml(a)}</span>\n\t\t</a>\n\t</div>`}\n\t\t\t\t${o.map((e,a)=>`<div class="hero-card__guideline-item" style="grid-column: 4; grid-row: 2;">\n\t\t\t<img src="${e}" alt="Guideline ${a+9}" loading="lazy" ${t} class="hero-card__guideline-image">\n\t\t</div>`).join("")}\n\t\t\t\t${l.map((e,a)=>`<div class="hero-card__guideline-item" style="grid-column: 1; grid-row: 3;">\n\t\t\t<img src="${e}" alt="Guideline ${a+10}" loading="lazy" ${t} class="hero-card__guideline-image">\n\t\t</div>`).join("")}\n\t\t\t\t${i.map((e,a)=>`<div class="hero-card__guideline-item" style="grid-column: 4; grid-row: 3;">\n\t\t\t<img src="${e}" alt="Guideline ${a+11}" loading="lazy" ${t} class="hero-card__guideline-image">\n\t\t</div>`).join("")}\n\t\t\t\t${s.map((e,a)=>`<div class="hero-card__guideline-item" style="grid-column: ${a+1}; grid-row: 4;">\n\t\t\t<img src="${e}" alt="Guideline ${a+12}" loading="lazy" ${t} class="hero-card__guideline-image">\n\t\t</div>`).join("")+e.slice(0,2).map((e,a)=>`<div class="hero-card__guideline-item" style="grid-column: ${a+3}; grid-row: 4;">\n\t\t\t<img src="${e}" alt="Guideline ${a+4}" loading="lazy" ${t} class="hero-card__guideline-image">\n\t\t</div>`).join("")}\n\t\t\t</div>\n\t\t</div>\n\t`}function pickRandomCharacterImage(){const e=getRandomCharacterImages();return e[Math.floor(Math.random()*e.length)]}function getCharacterAltFromSrc(e){const t=(e.split("/").pop()||"").replace(".png","");return t?`Character ${t}`:"Character"}function getRandomizedLayout(e=[]){const t=(e,t)=>e+(Math.random()*t*2-t);return e.map(e=>{const a=t(.79,.16);return{x:t(e.x,10),y:t(e.y,10),w:Math.max(18,e.w*a),h:Math.max(18,e.h*a),r:t(e.r||0,16)}})}async function init(){console.log("ðŸŒ± Initialising Roots Roleplay hero experience...");await loadContent()&&(setRootsRImagePaths(),applyViewportScaling(),setupEventListeners(),setCategory("legal",{skipAutoOpen:!0}),activateAppShell(),spawnFloatingLogos(),console.log("âœ… Hero experience ready!"))}function setRootsRImagePaths(){const e=normalizeAssetPath("public/roots_R.png");document.documentElement.style.setProperty("--roots-r-image",`url('${e}')`)}async function loadContent(){try{const e=getBasePath(),t=e?`${e}/`:"/",[a,r,n,o]=await Promise.all([fetch(`${t}content/companies.json`).then(e=>e.json()),fetch(`${t}content/crime-factions.json`).then(e=>e.json()),fetch(`${t}content/nogos.json`).then(e=>e.json()),fetch(`${t}content/whitelist.json`).then(e=>e.json())]);state.companies=(a.companies||[]).filter(Boolean),state.crimeFactions=(r.factions||[]).filter(Boolean);const l=(n.steps||[]).filter(Boolean),i=createIntroImageCard("regelwerk-intro","public/roots_nogo.png"),s=l.length>0?{id:"regelwerk-einleitung",title:l[0].title||"Einleitung",content:l[0].content||"",tagline:"",isEinleitung:!0,showTextLabel:!0}:null,c=l.slice(1).map((e,t)=>({id:`nogo-${t}`,title:e.title||"",content:e.content||"",tagline:"",nogoNumber:t+1,showTextLabel:!0})),d={id:"guidelines",title:"Guidelines",content:"",tagline:"",guidelineImages:Array.from({length:10},(e,t)=>`public/guidelines/${t+4}.png`),showGuidelines:!0},u=createIntroImageCard("regelwerk-choice","public/whitelist/roots_choice.png");state.nogos=[...s?[s]:[],i,...c,u,d];const h=(o.steps||[]).filter(Boolean),g=createIntroImageCard("whitelist-welcome","public/whitelist/roots_welcome.png"),m=createIntroImageCard("whitelist-serverzeiten","public/whitelist/roots_serverzeiten.png"),p=h.map((e,t)=>{const a={id:`whitelist-step-${t}`,title:e.title||"",content:e.content||"",tagline:"",stepNumber:t+1,showTextLabel:!0,links:e.links||[],serverInfo:e.serverInfo||[],footer:e.footer||""};if(e.showGuidelines){const e=Array.from({length:10},(e,t)=>`public/guidelines/${t+4}.png`);a.showGuidelines=!0,a.guidelineImages=e,a.showTextLabel=!1}return a}),f=createIntroImageCard("whitelist-final","public/whitelist/roots_beginyourstory.png"),y=p.slice(0,6),v=p.slice(6);state.whitelist=[g,m,...y,f,...v];const b={id:"underworld-mystery",title:"???",placeholder:!0,placeholderText:"WÃ¤hle dein Syndikat",placeholderVariant:"illegal-mystery"};state.crimeFactions=[b,...state.crimeFactions];const _={id:"mystery",displayName:"Dein Weg",title:"Dein Weg",description:"",image:"",placeholder:!0,placeholderText:"Dich"};return state.companies=[_,...state.companies],!0}catch(e){return console.error("âŒ Failed to load content:",e),!1}}function activateAppShell(){const e=document.getElementById("appRoot");e&&(e.classList.add("app--active"),e.classList.remove("app--gated"))}function wireChoiceButton(e,{autoOpenDetail:t=!1}={}){if(!e)return;const a=t?"detailChoiceBound":"heroChoiceBound";if("1"!==e.dataset[a]){if(e.dataset.choice){const a=a=>{a&&a.preventDefault();const r=e.dataset.choice;r&&setCategory(r,{autoOpen:t})};e.addEventListener("click",a),addKeyboardSupport(e,a)}else if(e.dataset.link){const t=t=>{t&&t.preventDefault();const a=e.dataset.link;a&&window.open(a,"_blank","noopener")};e.addEventListener("click",t),addKeyboardSupport(e,t)}e.dataset[a]="1"}}function setupEventListeners(){document.querySelectorAll(".hero-choice__btn").forEach(e=>{wireChoiceButton(e,{autoOpenDetail:!1})});const e=document.getElementById("crimeBack");e&&(e.addEventListener("click",()=>closeDetail()),addKeyboardSupport(e,()=>closeDetail()));const t=document.getElementById("crimePrev");t&&(t.addEventListener("click",()=>navigateDetail(-1)),addKeyboardSupport(t,()=>navigateDetail(-1)));const a=document.getElementById("crimeNext");a&&(a.addEventListener("click",()=>navigateDetail(1)),addKeyboardSupport(a,()=>navigateDetail(1))),document.addEventListener("keydown",e=>{"Escape"===e.key?document.body.classList.contains("is-split-open")?exitSplitMode():closeDetail():"ArrowRight"===e.key&&isDetailOpen()?navigateDetail(1):"ArrowLeft"===e.key&&isDetailOpen()?navigateDetail(-1):"ArrowRight"!==e.key||isDetailOpen()?"ArrowLeft"!==e.key||isDetailOpen()||navigateHeroRail(-1):navigateHeroRail(1)}),window.addEventListener("resize",()=>{isDetailOpen()&&requestAnimationFrame(alignCollageToMedia),resetHeroRailIdle()},{passive:!0}),document.addEventListener("pointermove",handleCardTiltMove,{passive:!0}),document.addEventListener("pointerleave",resetCardTilt,{passive:!0,capture:!0}),initHeroRailButtons()}function setCategory(e,t={}){if(!CATEGORY_CONFIG[e])return;state.currentCategory=e;const a=getDataset(e);state.currentIndex=0,document.body.classList.toggle("is-whitelist","whitelist"===e),updateChoiceButtons(),resetHeroRailIdle(),clearHeroRandomSpin(),renderHeroCards(a,e);const r=document.getElementById("heroDynamicBg");r&&("regelwerk"===e||"whitelist"===e||"legal"===e||"illegal"===e?spawnFloatingLogos(e):(r.innerHTML="",Array.isArray(spawnFloatingLogos._highlightTimers)&&spawnFloatingLogos._highlightTimers.forEach(e=>clearTimeout(e)),spawnFloatingLogos._highlightTimers=[])),0!==a.length?t.autoOpen?openDetail(e,state.currentIndex):t.skipAutoOpen||(closeDetail({silent:!0,force:!0}),highlightHeroCard(state.currentIndex)):closeDetail({silent:!0,force:!0})}function updateChoiceButtons(){document.querySelectorAll(".hero-choice__btn[data-choice]").forEach(e=>{e.classList.toggle("is-active",e.dataset.choice===state.currentCategory)})}function renderHeroCards(e,t=state.currentCategory){const a=document.getElementById("heroCardStack");if(!a)return;if(a.innerHTML="",a.classList.toggle("is-illegal","illegal"===t),a.classList.toggle("is-whitelist","whitelist"===t),a.classList.add("as-rail"),!Array.isArray(e)||0===e.length){const e=document.createElement("p");return e.className="hero-empty",e.textContent="Keine EintrÃ¤ge gefunden.",a.appendChild(e),void(state.heroCardsMounted=!1)}const r=document.createElement("div");if(r.className="hero-card-track",e.length>0){const a=getHeroCardImage(e[0],t);if(a){const e=document.createElement("link");e.rel="preload",e.as="image",e.href=normalizeAssetPath(a),e.fetchPriority="high",document.head.appendChild(e)}}if(e.forEach((a,n)=>{const o=createHeroCard(a,n,t);if(r.appendChild(o),"whitelist"===t&&n<e.length-1){const e=document.createElement("div");e.className="hero-card-arrow",e.innerHTML='<svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>',e.setAttribute("aria-hidden","true"),e.style.setProperty("--animation-delay",.1*n+"s"),r.appendChild(e)}}),"legal"===t||"illegal"===t){const e=document.createElement("div");e.className="hero-rail-hint",e.innerHTML='<span class="hero-rail-hint__text">Wir Suchen</span><span class="hero-rail-hint__arrow">â†’</span>',r.insertBefore(e,r.firstChild||null)}a.appendChild(r),state.heroCardsMounted=!0;const n=clampHeroIndex(state.currentIndex);state.currentIndex=n;const o=0===n?"start":"center";requestAnimationFrame(()=>{requestAnimationFrame(()=>{const e=getHeroRail();e&&(e.scrollLeft=0,focusHeroRailIndex(n,{smooth:!1,align:o}))})}),setupHeroRailControls()}function createHeroCard(e,t,a){const r=document.createElement("button");r.type="button";const n=!(!e||!0!==e.placeholder);r.className="hero-card"+("illegal"===a?" hero-card--illegal":"")+("regelwerk"===a?" hero-card--regelwerk":"")+("whitelist"===a?" hero-card--whitelist":"")+(n?" hero-card--placeholder":""),r.dataset.index=String(t),r.dataset.category=a;const o=t<3,l=o?"eager":"lazy",i=o?'fetchpriority="high"':"",s='decoding="async"',c=getHeroCardImage(e,a),d=getHeroCardLogo(e,a),u="regelwerk"===a&&e?.isIntroImageCard,h="whitelist"===a&&e?.isIntroImageCard,g=c?ensureAbsolutePathForCSS(c):"",m=d?ensureAbsolutePathForCSS(d):"",p="illegal"===a||u||h?g?`url('${g}')`:"":m?`url('${m}')`:"",f=CATEGORY_CONFIG[a].getTitle(e);r.setAttribute("aria-label",n?"":`${f} Ã¶ffnen`),p&&r.style.setProperty("--card-logo",p);const y=n?e?.placeholderText||("illegal"===a?"WÃ¤hle dein Syndikat":"Dich"):"";let v;if(n)v="illegal"===a?(()=>{const e=getCrimeShuffleImages();let t=getUniqueRandomImages(e,Math.min(8,e.length));if(t.length<8&&e.length>=8){const a=new Set(t.map(e=>normalizeAssetPath(e))),r=e.filter(e=>!a.has(normalizeAssetPath(e))),n=8-t.length;if(r.length>=n){const e=getUniqueRandomImages(r,n);t=[...t,...e]}}const a=new Set,r=[];for(t.forEach(e=>{const t=normalizeAssetPath(e);a.has(t)||(r.push(t),a.add(t))});r.length<8&&e.length>0;){const t=e.map(normalizeAssetPath).filter(e=>!a.has(e));if(0===t.length)break;const n=t[Math.floor(Math.random()*t.length)];r.push(n),a.add(n)}const n=[];for(let t=0;t<8;t++)if(t<r.length){const e=normalizeAssetPath(r[t]),a=getCharacterAltFromSrc(e);n.push(`\n\t\t\t\t\t<div class="illegal-placeholder__cell">\n\t\t\t\t\t\t<img class="illegal-placeholder__image" src="${e}" alt="${escapeHtml(a)}" loading="lazy" ${s} aria-hidden="true" onerror="this.style.display='none'; const cell=this.closest('.illegal-placeholder__cell'); if(cell) cell.style.display='none';">\n\t\t\t\t\t</div>\n\t\t\t\t`)}else{const t=e.map(normalizeAssetPath).filter(e=>!a.has(e));if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];a.add(e);const r=getCharacterAltFromSrc(e);n.push(`\n\t\t\t\t\t\t<div class="illegal-placeholder__cell">\n\t\t\t\t\t\t\t<img class="illegal-placeholder__image" src="${e}" alt="${escapeHtml(r)}" loading="lazy" ${s} aria-hidden="true" onerror="this.style.display='none'; const cell=this.closest('.illegal-placeholder__cell'); if(cell) cell.style.display='none';">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`)}else n.push(`\n\t\t\t\t\t\t<div class="illegal-placeholder__cell">\n\t\t\t\t\t\t\t<img class="illegal-placeholder__image" src="" alt="" loading="lazy" ${s} aria-hidden="true" style="display: none;">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`)}return`\n\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t<div class="illegal-placeholder">\n\t\t\t\t<div class="illegal-placeholder__stage">\n\t\t\t\t\t<div class="illegal-placeholder__grid" data-count="8">${n.join("")}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="illegal-placeholder__controls">\n\t\t\t\t\t<button class="split-shuffle" type="button" aria-label="Neue Crew mischen"><span class="split-shuffle__icon">âœ¦</span><span class="split-shuffle__text">Dich</span></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`})():`\n\t\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t\t<span class="hero-card__single-logo" aria-hidden="true"></span>\n\t\t\t\t<span class="hero-card__text">${escapeHtml(y)}</span>\n\t\t\t`;else if("regelwerk"===a||"whitelist"===a)if(e?.isIntroImageCard){v=`\n\t\t\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t\t\t<img class="hero-card__image" src="${c}" alt="${"whitelist"===a?"Serverzeiten":"Roots NoGo"}" loading="${l}" ${i} ${s}>\n\t\t\t\t`}else if(e?.showGuidelines){v=buildGuidelineGridHTML(e.guidelineImages||[],s)}else if(e?.showTextLabel){const I=(CATEGORY_CONFIG[a].getContent(e)||"").split(/\n{2,}/).map(e=>e.replace(/\n/g," ").trim()).filter(e=>e.length>0).map(e=>`<p>${escapeHtml(e)}</p>`).join("");if(e?.isEinleitung)v=`\n\t\t\t\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t\t\t\t<div class="hero-card__nogo-content">\n\t\t\t\t\t\t\t<div class="hero-card__nogo-header">\n\t\t\t\t\t\t\t\t<span class="hero-card__text hero-card__text--nogo hero-card__text--einleitung">Einleitung</span>\n\t\t\t\t\t\t\t\t<span class="hero-card__text-title">${escapeHtml(f)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="hero-card__nogo-description">${I}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;else if("whitelist"===a){const L=e.stepNumber||t;if(e?.showGuidelines){v=buildGuidelineGridHTML(e.guidelineImages||[],s,"Komm auf unseren Discord")}else{let T="";if(e.links&&e.links.length>0){T=`<div class="hero-card__nogo-buttons">${e.links.map(e=>`<a href="${escapeHtml(e.url)}" target="_blank" rel="noopener noreferrer" class="hero-card__nogo-button">\n\t\t\t\t\t\t\t\t<span class="hero-card__nogo-button-text">${escapeHtml(e.text)}</span>\n\t\t\t\t\t\t\t</a>`).join("")}</div>`}let A="";if(e.serverInfo&&e.serverInfo.length>0){A=`<div class="hero-card__server-info-container">${e.serverInfo.map((e,t)=>`<div class="hero-card__server-info" data-copy-text="${escapeHtml(e)}" data-copy-id="server-${L}-${t}">\n\t\t\t\t\t\t\t\t<span class="hero-card__server-info-text">${escapeHtml(e)}</span>\n\t\t\t\t\t\t\t\t<span class="hero-card__server-info-hint">Klicken zum Kopieren</span>\n\t\t\t\t\t\t\t\t<span class="hero-card__server-info-copied">âœ“ Kopiert!</span>\n\t\t\t\t\t\t\t</div>`).join("")}</div>`}let M="";if(5===L&&e.serverInfo&&e.serverInfo.length>0){let S=e.serverInfo.find(e=>e.includes(":"))||e.serverInfo[0];S.includes(":")||(S=`${S}:9987`),M=`<a href="ts3server://${S}" class="hero-card__quick-connect hero-card__quick-connect--teamspeak">\n\t\t\t\t\t\t\t<svg class="hero-card__quick-connect-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t\t\t<path d="M12 2a10 10 0 00-3.92 19.21c.62.11.85-.27.85-.6v-2.1c-3.46.75-4.18-1.67-4.18-1.67-.57-1.44-1.38-1.82-1.38-1.82-1.13-.78.09-.77.09-.77 1.26.09 1.92 1.3 1.92 1.3 1.11 1.92 2.9 1.36 3.61 1.04.11-.8.43-1.36.78-1.67-2.77-.32-5.69-1.38-5.69-6.15 0-1.36.51-2.47 1.3-3.34-.13-.33-.56-1.67.12-3.47 0 0 1.05-.33 3.45 1.29.99-.28 2.05-.42 3.11-.42s2.12.14 3.11.42c2.4-1.62 3.45-1.29 3.45-1.29.68 1.8.25 3.14.12 3.47.8.87 1.3 1.98 1.3 3.34 0 4.79-2.92 5.83-5.7 6.14.44.38.84 1.12.84 2.27v3.36c0 .33.22.71.86.59A10 10 0 0012 2z"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span>Quick Connect</span>\n\t\t\t\t\t\t</a>`}else if(7===L&&e.serverInfo&&e.serverInfo.length>0){M=`<a href="fivem://connect/${e.serverInfo[0].replace(/^connect\s+/i,"").trim()}" class="hero-card__quick-connect hero-card__quick-connect--fivem">\n\t\t\t\t\t\t\t<svg class="hero-card__quick-connect-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">\n\t\t\t\t\t\t\t\t<path d="M12.46 2c.32 0 .6.18.75.46l8.24 16.27c.21.4.06.9-.34 1.11-.12.07-.26.1-.4.1h-4.5l-2.04-4.57a.9.9 0 00-1.64 0L9.5 19.94H4.75c-.46 0-.84-.38-.84-.84 0-.13.03-.27.1-.4l8.24-16.24A.85.85 0 0112.46 2zm.51 8.87l3.22 7.21h2.14l-5.36-10.7-1.77 3.49 1.77-.02zm-1.94 4.1l-1.2 3.1h2.45l-1.25-3.1z"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span>Quick Connect</span>\n\t\t\t\t\t\t</a>`}let E="";e.footer&&(E=`<div class="hero-card__whitelist-footer">${escapeHtml(e.footer)}</div>`),v=`\n\t\t\t\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t\t\t\t<div class="hero-card__whitelist-content">\n\t\t\t\t\t\t\t<div class="hero-card__whitelist-header">\n\t\t\t\t\t\t\t\t<span class="hero-card__whitelist-step">Schritt ${L}</span>\n\t\t\t\t\t\t\t\t<span class="hero-card__whitelist-title">${escapeHtml(f)}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="hero-card__whitelist-description">${I}</div>\n\t\t\t\t\t\t\t${T}\n\t\t\t\t\t\t\t${A}\n\t\t\t\t\t\t\t${E}\n\t\t\t\t\t\t\t${M}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,r.style.setProperty("--animation-delay",.1*t+"s"),r.classList.add("hero-card--whitelist-step"),e.serverInfo&&e.serverInfo.length>0&&setTimeout(()=>{r.querySelectorAll(".hero-card__server-info").forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault();const a=e.dataset.copyText;if(a){e.classList.add("hero-card__server-info--copied"),e.classList.add("hero-card__server-info--no-hover");try{await navigator.clipboard.writeText(a),setTimeout(()=>{e.classList.remove("hero-card__server-info--copied"),setTimeout(()=>{e.classList.remove("hero-card__server-info--no-hover")},300)},2500)}catch(t){console.error("Failed to copy:",t),e.classList.remove("hero-card__server-info--copied"),e.classList.remove("hero-card__server-info--no-hover")}}})})},100)}}else{const x=e.nogoNumber||t+1;let R=I;if(11===x){const k="https://runtime.fivem.net/platform-license-agreement-12-sept-2023.pdf",$="https://www.rockstargames.com/legal";R=I.replace(/<p>Links:.*$/m,"").replace(/<p>.*CFX Platform License Agreement.*$/m,"").replace(/<p>.*Rockstar Games Legal.*$/m,"").trim()+`<div class="hero-card__nogo-buttons">\n\t\t\t\t\t\t\t<a href="${k}" target="_blank" rel="noopener noreferrer" class="hero-card__nogo-button">\n\t\t\t\t\t\t\t\t<span class="hero-card__nogo-button-text">CFX Platform License Agreement</span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<a href="${$}" target="_blank" rel="noopener noreferrer" class="hero-card__nogo-button">\n\t\t\t\t\t\t\t\t<span class="hero-card__nogo-button-text">Rockstar Games Legal</span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</div>`}v=`\n\t\t\t\t\t<div class="hero-card__flip-container">\n\t\t\t\t\t\t<div class="hero-card__face hero-card__face--back">\n\t\t\t\t\t\t\t<img src="${normalizeAssetPath("public/roots_R.png")}" alt="Roots" loading="${l}" ${i} ${s}>\n\t\t\t\t\t\t\t<span class="hero-card__footer">Klicken zum Umdrehen</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="hero-card__face hero-card__face--front">\n\t\t\t\t\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t\t\t\t\t<div class="hero-card__nogo-content">\n\t\t\t\t\t\t\t\t<div class="hero-card__nogo-header">\n\t\t\t\t\t\t\t\t\t<span class="hero-card__text hero-card__text--nogo">NoGo ${x}</span>\n\t\t\t\t\t\t\t\t\t<span class="hero-card__text-title">${escapeHtml(f)}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="hero-card__nogo-description">${R}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="hero-card__footer">Klicken zum Umdrehen</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`,1!==x&&r.classList.add("hero-card--flipped")}}else v=`\n\t\t\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t\t\t<img class="hero-card__image" src="${c}" alt="${escapeHtml(f)}" loading="${l}" ${i} ${s}>\n\t\t\t\t`;else v=`\n\t\t\t\t<span class="hero-card__backdrop" aria-hidden="true"></span>\n\t\t\t\t<img class="hero-card__image" src="${c}" alt="${escapeHtml(f)}" loading="${l}" ${i} ${s}>\n\t\t\t`;const b="regelwerk"!==a&&"whitelist"!==a||"regelwerk"===a&&!e?.showTextLabel&&!e?.isIntroImageCard&&!e?.showGuidelines,_=n?"":"Zum Ã–ffnen klicken";if(r.innerHTML=`\n\t\t${v}\n\t\t${b?`<span class="hero-card__footer">${_}</span>`:""}\n\t`,n&&(r.style.setProperty("--card-logo","none"),"illegal"===a&&setTimeout(()=>{const e=r.querySelector(".illegal-placeholder__grid");if(e){const t=Array.from(e.querySelectorAll(".illegal-placeholder__image")),a=getCrimeShuffleImages();t.forEach((t,r)=>{let n=0;const o=()=>{const r=Array.from(e.querySelectorAll(".illegal-placeholder__image")),o=new Set;r.forEach(e=>{if(e.src&&e.src!==t.src&&e.complete&&e.naturalHeight>0){const t=normalizeAssetPath(e.src);o.add(t)}});const l=a.map(normalizeAssetPath).filter(e=>{const t=normalizeAssetPath(e);return!o.has(t)});if(l.length>0&&n<10){n++;const e=normalizeAssetPath(l[Math.floor(Math.random()*l.length)]);t.src=e,t.alt=getCharacterAltFromSrc(e),t.style.display="",t.style.visibility="visible"}else if(n>=10&&l.length>0){const e=normalizeAssetPath(l[0]);t.src=e,t.alt=getCharacterAltFromSrc(e),t.style.display="",t.style.visibility="visible"}};t.onerror=o,t.src&&""!==t.src&&t.complete&&0!==t.naturalHeight||setTimeout(()=>{t.src&&""!==t.src&&t.complete&&0!==t.naturalHeight||o()},100),setTimeout(()=>{t.complete&&0!==t.naturalHeight||o()},500)})}},100)),("regelwerk"===a||"whitelist"===a)&&!n&&e?.showTextLabel){const H=r.querySelector(".hero-card__nogo-description");H&&requestAnimationFrame(()=>{autoSizeTextToFit(H)})}if(n&&"illegal"===a){const P=r.querySelector(".illegal-placeholder"),z=r.querySelector(".split-shuffle"),D=r.querySelector(".illegal-placeholder__grid");if(P&&D&&z){const F="illegal-placeholder__cell--selected";let N=!1;const q=[60,80,100,120,140,160,200,240,280,340,420,520],B=()=>Array.from(D.querySelectorAll(".illegal-placeholder__cell")),V=()=>Array.from(D.querySelectorAll(".illegal-placeholder__image"));new Set;getCrimeShuffleImages();const O=()=>{B().forEach(e=>e.classList.remove(F))};z.addEventListener("click",e=>{if(e.preventDefault(),e.stopPropagation(),N)return;N=!0,O(),z.disabled=!0,z.classList.add("is-rolling");const t=getCrimeShuffleImages();let a=getUniqueRandomImages(t,Math.min(8,t.length));if(a.length<8&&t.length>=8){const e=new Set(a.map(e=>normalizeAssetPath(e))),r=t.filter(t=>!e.has(normalizeAssetPath(t))),n=8-a.length;if(r.length>=n){const e=getUniqueRandomImages(r,n);a=[...a,...e]}}const r=new Set;let n=0;const o=()=>{if(V().forEach((e,l)=>{if(n<q.length-1){const a=t.filter(e=>{const t=normalizeAssetPath(e);return!r.has(t)});if(0===a.length){r.clear();const a=t.map(e=>normalizeAssetPath(e)),n=a[Math.floor(Math.random()*a.length)];r.add(n),e.src=n,e.alt=getCharacterAltFromSrc(n),e.loading="lazy",e.decoding="async"}else{const t=normalizeAssetPath(a[Math.floor(Math.random()*a.length)]);r.add(t),e.src=t,e.alt=getCharacterAltFromSrc(t),e.loading="lazy",e.decoding="async"}e.onerror=()=>{const a=t.filter(e=>{const t=normalizeAssetPath(e);return!r.has(t)});if(a.length>0){const t=normalizeAssetPath(a[Math.floor(Math.random()*a.length)]);r.add(t),e.src=t}}}else if(o._usedFinalImages||(o._usedFinalImages=new Set),l<8){let r=null;if(l<a.length){const e=normalizeAssetPath(a[l]);o._usedFinalImages.has(e)||(r=e,o._usedFinalImages.add(r))}if(!r)for(let e=0;e<a.length;e++){const t=normalizeAssetPath(a[e]);if(!o._usedFinalImages.has(t)){r=t,o._usedFinalImages.add(r);break}}if(!r){const e=t.filter(e=>{const t=normalizeAssetPath(e);return!o._usedFinalImages.has(t)});e.length>0&&(r=normalizeAssetPath(e[Math.floor(Math.random()*e.length)]),o._usedFinalImages.add(r))}if(r){const n=getCharacterAltFromSrc(r);e.src=r,e.alt=n,e.style.display="",e.onerror=()=>{o._usedFinalImages.delete(r);const n=a.filter(e=>{const t=normalizeAssetPath(e);return!o._usedFinalImages.has(t)});if(n.length>0){const t=normalizeAssetPath(n[0]);o._usedFinalImages.add(t),e.src=t,e.alt=getCharacterAltFromSrc(t)}else{const a=t.filter(e=>{const t=normalizeAssetPath(e);return!o._usedFinalImages.has(t)});if(a.length>0){const t=normalizeAssetPath(a[Math.floor(Math.random()*a.length)]);o._usedFinalImages.add(t),e.src=t,e.alt=getCharacterAltFromSrc(t)}}}}}}),n<q.length-1?r.clear():n===q.length-1&&o._usedFinalImages&&o._usedFinalImages.clear(),n++,n<q.length)setTimeout(o,q[n]);else{const e=B();e.length&&e[Math.floor(Math.random()*e.length)].classList.add(F),z.classList.remove("is-rolling"),z.disabled=!1,N=!1}};setTimeout(o,q[0])})}}else if(n&&"legal"===a&&!e?.isHint){const G=3,Y=[...getRandomCharacterImages(),...getCompanyCharacterImages(),...getCrimeCharacterImages(),...getCrimeShuffleImages()],U=e=>getCharacterAltFromSrc(e),W=new Set,j=()=>{},K=()=>{},X=()=>{r.querySelectorAll(".split-panel--selected").forEach(e=>e.classList.remove("split-panel--selected"))},Q=()=>{let e=r.querySelector(".split-shuffle");return e||(e=document.createElement("button"),e.type="button",e.className="split-shuffle",e.innerHTML='<span class="split-shuffle__icon">âœ¦</span><span class="split-shuffle__text">Shuffle</span>',e.addEventListener("click",t=>{t.stopPropagation(),X();if(0===Array.from(r.querySelectorAll(".split-panel__image")).length)return;e.disabled=!0,e.classList.add("is-rolling");const a=[60,80,100,120,140,160,200,240,280,340,420,520],n=Array.from(r.querySelectorAll(".split-panel__image")),o=getUniqueRandomImages(Y,n.length);const l=new Set;let i=0;const s=()=>{const t=Array.from(r.querySelectorAll(".split-panel__image"));if(i<a.length-1)t.forEach(e=>{const t=Y.filter(e=>{const t=normalizeAssetPath(e);return!l.has(t)});if(0===t.length){l.clear();const t=Y.map(e=>normalizeAssetPath(e)),a=t[Math.floor(Math.random()*t.length)];l.add(a),e.src=a,e.alt=U(a),e.loading="lazy",e.decoding="async"}else{const a=normalizeAssetPath(t[Math.floor(Math.random()*t.length)]);l.add(a),e.src=a,e.alt=U(a),e.loading="lazy",e.decoding="async"}}),l.clear();else{const e=new Set;t.forEach((t,a)=>{let r;if(a<o.length){if(r=normalizeAssetPath(o[a]),e.has(r)){const t=Y.filter(t=>{const a=normalizeAssetPath(t);return!e.has(a)});r=t.length>0?normalizeAssetPath(t[Math.floor(Math.random()*t.length)]):normalizeAssetPath(Y[Math.floor(Math.random()*Y.length)])}e.add(r)}else{const t=Y.filter(t=>{const a=normalizeAssetPath(t);return!e.has(a)});t.length>0?(r=normalizeAssetPath(t[Math.floor(Math.random()*t.length)]),e.add(r)):(r=normalizeAssetPath(Y[Math.floor(Math.random()*Y.length)]),e.add(r))}r&&(t.src=r,t.alt=U(r),t.onerror=()=>{const a=Y.filter(t=>{const a=normalizeAssetPath(t);return!e.has(a)});if(a.length>0){const r=normalizeAssetPath(a[Math.floor(Math.random()*a.length)]);e.add(r),t.src=r}})})}if(i++,i<a.length)setTimeout(s,a[i]);else{const t=Array.from(r.querySelectorAll(".split-panel"));if(t.forEach(e=>e.classList.remove("split-panel--selected")),t.length>0){t[Math.floor(Math.random()*t.length)].classList.add("split-panel--selected")}e.classList.remove("is-rolling"),e.disabled=!1}};setTimeout(s,a[0])}),r.appendChild(e),e)};function C(e,t){for(let a=0;a<4;a++){const r=document.createElement("div");r.className=`split-panel split-panel--${a}`;const n=Y.filter(e=>{const t=normalizeAssetPath(e);return!W.has(t)});let o;if(0===n.length){W.clear();const e=Y.map(e=>normalizeAssetPath(e));o=e[Math.floor(Math.random()*e.length)],W.add(o)}else o=normalizeAssetPath(n[Math.floor(Math.random()*n.length)]),W.add(o);const l=U(o),i=normalizeAssetPath("public/roots_R.png");r.innerHTML=`\n\t\t\t\t\t<span class="split-panel__backdrop" style="background-image: url('${i}');"></span>\n\t\t\t\t\t<img class="split-panel__image" src="${o}" alt="${l}" loading="lazy" decoding="async">\n\t\t\t\t`;const s=r.querySelector(".split-panel__image");s&&(s.onerror=()=>{const e=Y.filter(e=>{const t=normalizeAssetPath(e);return!W.has(t)});if(e.length>0){const t=normalizeAssetPath(e[Math.floor(Math.random()*e.length)]);W.add(t),s.src=t,s.alt=U(t)}}),r.addEventListener("click",e=>{e.stopPropagation(),t<G&&w(r,t+1)}),e.appendChild(r)}}function w(e,t){t>G||(e.classList.add("split-panel--splitting"),setTimeout(()=>{const a=document.createElement("div");a.className=`split-grid split-grid--level-${t}`,C(a,t),X(),e.innerHTML="",e.appendChild(a),j(a),K(),Q()},200))}r.addEventListener("click",function e(){if(r.querySelector(".split-grid"))return;const t=document.createElement("div");t.className="split-grid split-grid--level-1",C(t,1),X(),r.innerHTML="",r.appendChild(t),j(t),K(),Q(),r.removeEventListener("click",e)})}else if(!n)if("regelwerk"===a)e?.showTextLabel&&!e?.isEinleitung?(r.style.cursor="pointer",r.addEventListener("click",e=>{Date.now()<(state.heroRailDragging.blockClickUntil||0)||r.classList.toggle("hero-card--flipped")})):r.style.cursor="default";else if("whitelist"===a)r.style.cursor="default";else{const Z=()=>{Date.now()<(state.heroRailDragging.blockClickUntil||0)||openDetail(a,t)};r.addEventListener("click",Z),addKeyboardSupport(r,Z)}return r}function getHeroRail(){return document.getElementById("heroCardStack")}function getHeroRailCards(){const e=getHeroRail();return e?Array.from(e.querySelectorAll(`.hero-card[data-category="${state.currentCategory}"]`)):[]}const heroRailScrollState={ticking:!1,targetIndex:null,wheelLocked:!1,startLock:!1};function clampHeroIndex(e){const t=getDataset(state.currentCategory);return t&&0!==t.length?Math.max(0,Math.min(t.length-1,e)):0}function focusHeroRailIndex(e,{smooth:t=!0,pulse:a=!1,align:r="center"}={}){const n=getHeroRail(),o=getHeroRailCards();if(!n||0===o.length)return;const l=clampHeroIndex(e),i=o[l];if(!i)return;let s;state.currentIndex=l,highlightHeroCard(l),heroRailScrollState.targetIndex=t?l:null,heroRailScrollState.startLock="start"===r,s="start"===r?0===l?0:Math.max(0,i.offsetLeft):Math.max(0,i.offsetLeft-(n.clientWidth-i.clientWidth)/2);const c="function"==typeof n.scrollTo,d=t&&c?"smooth":"auto";try{c?n.scrollTo({left:s,behavior:d}):n.scrollLeft=s}catch{n.scrollLeft=s}a&&(i.classList.add("hero-card--pulse"),setTimeout(()=>i.classList.remove("hero-card--pulse"),700))}function syncHeroRailIndexFromScroll({force:e=!1}={}){const t=getHeroRail(),a=getHeroRailCards();if(!t||0===a.length)return;if(heroRailScrollState.startLock&&t.scrollLeft<=2)return void(e&&(heroRailScrollState.startLock=!1));const r=t.getBoundingClientRect(),n=r.left+r.width/2;let o=state.currentIndex,l=Number.POSITIVE_INFINITY;if(a.forEach((e,t)=>{const a=e.getBoundingClientRect(),r=a.left+a.width/2,i=Math.abs(r-n);i<l&&(l=i,o=t)}),!e&&null!==heroRailScrollState.targetIndex){if(o!==heroRailScrollState.targetIndex)return;heroRailScrollState.targetIndex=null}(e||o!==state.currentIndex)&&(state.currentIndex=o,highlightHeroCard(o))}function scheduleHeroRailSync(e=!1){if(e)return heroRailScrollState.ticking=!1,void syncHeroRailIndexFromScroll({force:!0});heroRailScrollState.ticking||(heroRailScrollState.ticking=!0,requestAnimationFrame(()=>{heroRailScrollState.ticking=!1,syncHeroRailIndexFromScroll()}))}function navigateHeroRail(e=1){const t=getDataset(state.currentCategory);if(!t||0===t.length)return;focusHeroRailIndex(clampHeroIndex(state.currentIndex+(e||1)),{smooth:!0}),resetHeroRailIdle()}function setupHeroRailControls(){const e=getHeroRail();if(!e||!state.heroCardsMounted)return;if("1"===e.dataset.controlsInit)return resetHeroRailIdle(),void scheduleHeroRailSync(!0);e.dataset.controlsInit="1",initHeroRailButtons(),initHeroRailRandom();e.addEventListener("wheel",e=>{if(isDetailOpen())return;if(heroRailScrollState.wheelLocked)return void e.preventDefault();const t=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;0!==t&&(e.preventDefault(),navigateHeroRail(t>0?1:-1),heroRailScrollState.wheelLocked=!0,setTimeout(()=>{heroRailScrollState.wheelLocked=!1},260))},{passive:!1}),e.addEventListener("scroll",()=>scheduleHeroRailSync(),{passive:!0});const t=document.getElementById("appRoot");t?.addEventListener("wheel",t=>{if(isDetailOpen())return;if(e.contains(t.target))return;if(heroRailScrollState.wheelLocked)return void t.preventDefault();const a=Math.abs(t.deltaY)>Math.abs(t.deltaX)?t.deltaY:t.deltaX;0!==a&&(t.preventDefault(),navigateHeroRail(a>0?1:-1),heroRailScrollState.wheelLocked=!0,setTimeout(()=>{heroRailScrollState.wheelLocked=!1},260))},{passive:!1});const a=document.getElementById("heroRailPrev"),r=document.getElementById("heroRailNext");a?.addEventListener("click",()=>navigateHeroRail(-1)),r?.addEventListener("click",()=>navigateHeroRail(1));const n=()=>resetHeroRailIdle();["pointerdown","keydown","touchstart"].forEach(t=>{e.addEventListener(t,n,{passive:!0})}),resetHeroRailIdle(),scheduleHeroRailSync(!0)}function initHeroRailButtons(){if(state.heroControlsInit)return;const e=document.getElementById("heroRailBottomPrev"),t=document.getElementById("heroRailBottomNext");e?.addEventListener("click",()=>navigateHeroRail(-1)),t?.addEventListener("click",()=>navigateHeroRail(1)),state.heroControlsInit=!0}function initHeroRailDrag(e){const t=state.heroRailDragging,a=a=>{if(t.active){if(t.active=!1,e.classList.remove("is-dragging"),void 0!==a?.pointerId)try{e.releasePointerCapture(a.pointerId)}catch{}t.moved&&(t.blockClickUntil=Date.now()+300,scheduleHeroRailSync(!0)),t.moved=!1}};e.addEventListener("pointerdown",a=>{if(1===a.button||2===a.button)return;if(a.pointerType&&"mouse"!==a.pointerType)return;const r=e.getBoundingClientRect();t.active=!0,t.startX=a.clientX-r.left,t.scrollLeft=e.scrollLeft,t.moved=!1,resetHeroRailIdle()}),e.addEventListener("pointermove",a=>{if(!t.active)return;const r=e.getBoundingClientRect(),n=a.clientX-r.left-t.startX;!t.moved&&Math.abs(n)>4&&(t.moved=!0,e.classList.add("is-dragging"),void 0!==a.pointerId&&e.setPointerCapture(a.pointerId)),t.moved&&(e.scrollLeft=t.scrollLeft-n,a.preventDefault())}),e.addEventListener("pointerup",a),e.addEventListener("pointercancel",a),e.addEventListener("pointerleave",a)}function getHeroCardByIndex(e){return getHeroRailCards()[e]||null}function tagHeroCard(e,t,a=420){const r=getHeroCardByIndex(e);if(r&&(r.classList.add(t),a>0)){const e=setTimeout(()=>r.classList.remove(t),a);state.heroRandomSpinTimeouts.push(e)}}function easeOutCubic(e){const t=clamp(e,0,1);return 1-Math.pow(1-t,3)}function getHeroRandomDelay(e,t){if(t<=1)return 480;const a=easeOutCubic(e/(t-1));return Math.round(lerp(64,620,a))}function clearHeroRandomSpin({keepRolling:e=!1,keepCooldown:t=!1}={}){if(state.heroRandomSpinTimeouts.length&&(state.heroRandomSpinTimeouts.forEach(e=>clearTimeout(e)),state.heroRandomSpinTimeouts=[]),document.querySelectorAll(".hero-card--roulette, .hero-card--random-lock").forEach(e=>e.classList.remove("hero-card--roulette","hero-card--random-lock")),!e){const e=document.getElementById("heroRailRandom");e?.classList.remove("is-rolling")}t||(state.heroRandomCooldown=!1),document.body.classList.remove("is-random-rolling","is-random-lock","is-random-reveal")}function buildHeroRandomSequence({startIndex:e,targetIndex:t,total:a}){if(a<=1)return[t];const r=[];let n=clampHeroIndex(e),o=Math.random()>.5?1:-1;const l=Math.min(12,2*a+4);for(let e=0;e<l;e+=1)(o>0&&n>=a-1||o<0&&n<=0)&&(o*=-1),e>.55*l?o=t>=n?1:-1:Math.random()<.25&&(o*=-1),n=clampHeroIndex(n+o),r.push(n);return 0!==r.length&&r[r.length-1]===t||r.push(t),r}function initHeroRailRandom(){const e=document.getElementById("heroRailRandom");if(!e)return;e.addEventListener("click",()=>{if(state.heroRandomCooldown)return;const t=getDataset(state.currentCategory);if(!t||0===t.length)return;if(state.heroRandomCooldown=!0,e.classList.add("is-rolling"),clearHeroRandomSpin({keepRolling:!0,keepCooldown:!0}),document.body.classList.add("is-random-rolling"),resetHeroRailIdle(),"regelwerk"===state.currentCategory){const a=t.map((e,t)=>({item:e,index:t})).filter(({item:e})=>e?.showTextLabel&&!e?.isEinleitung&&e?.nogoNumber&&e.nogoNumber>=2&&e.nogoNumber<=12).sort((e,t)=>(e.item.nogoNumber||0)-(t.item.nogoNumber||0));if(0===a.length)return e.classList.remove("is-rolling"),state.heroRandomCooldown=!1,void document.body.classList.remove("is-random-rolling");const r=a[Math.floor(Math.random()*a.length)].index,n=buildHeroRandomSequence({startIndex:clampHeroIndex(state.currentIndex),targetIndex:r,total:t.length}),o=n.length;let l=0;n.forEach((e,t)=>{const a=t===o-1,n=getHeroRandomDelay(t,o);l+=n;const i=setTimeout(()=>{if(jumpHeroRailToIndex(e,{smooth:0!==t,pulse:a||t>o-3,align:"center"}),a){tagHeroCard(r,"hero-card--random-lock",1120),document.body.classList.add("is-random-lock");const e=setTimeout(()=>{document.body.classList.remove("is-random-rolling"),document.body.classList.add("is-random-reveal"),highlightHeroCard(r),setTimeout(()=>document.body.classList.remove("is-random-reveal"),900),setTimeout(()=>{const e=getHeroCardByIndex(r);e&&e.classList.remove("hero-card--flipped")},500)},Math.min(460,n+160));state.heroRandomSpinTimeouts.push(e)}else tagHeroCard(e,"hero-card--roulette",n+180)},l);state.heroRandomSpinTimeouts.push(i)});const i=setTimeout(()=>{e.classList.remove("is-rolling"),state.heroRandomCooldown=!1,document.body.classList.remove("is-random-rolling","is-random-lock"),state.heroRandomSpinTimeouts=[]},l+900);return void state.heroRandomSpinTimeouts.push(i)}const a=t.map((e,t)=>({item:e,index:t})).filter(({item:e})=>!e?.placeholder);if(0===a.length)return e.classList.remove("is-rolling"),state.heroRandomCooldown=!1,void document.body.classList.remove("is-random-rolling");const r=clampHeroIndex(state.currentIndex);let n=a[Math.floor(Math.random()*a.length)],o=n.index;if(a.length>1&&o===r){const e=a.filter(({index:e})=>e!==r);n=e[Math.floor(Math.random()*e.length)],o=n.index}const l=buildHeroRandomSequence({startIndex:r,targetIndex:o,total:t.length}),i=l.length;let s=0;l.forEach((e,t)=>{const a=t===i-1,r=getHeroRandomDelay(t,i);s+=r;const n=setTimeout(()=>{if(jumpHeroRailToIndex(e,{smooth:0!==t,pulse:a||t>i-3,align:"center"}),a){const e=o;tagHeroCard(e,"hero-card--random-lock",1120),document.body.classList.add("is-random-lock");const t=setTimeout(()=>{document.body.classList.remove("is-random-rolling"),document.body.classList.add("is-random-reveal"),highlightHeroCard(e),setTimeout(()=>document.body.classList.remove("is-random-reveal"),900),setTimeout(()=>{const t=getDataset(state.currentCategory);if(t&&t.length>0&&e<t.length){t[e].placeholder||openDetail(state.currentCategory,e)}},1e3)},Math.min(460,r+160));state.heroRandomSpinTimeouts.push(t)}else tagHeroCard(e,"hero-card--roulette",r+180)},s);state.heroRandomSpinTimeouts.push(n)});const c=setTimeout(()=>{e.classList.remove("is-rolling"),state.heroRandomCooldown=!1,document.body.classList.remove("is-random-rolling","is-random-lock"),state.heroRandomSpinTimeouts=[]},s+900);state.heroRandomSpinTimeouts.push(c)})}function stopHeroRailAuto(){state.railAutoTimer&&(clearInterval(state.railAutoTimer),state.railAutoTimer=null)}function resetHeroRailIdle(){state.railIdleTimer&&(clearTimeout(state.railIdleTimer),state.railIdleTimer=null),stopHeroRailAuto()}function jumpHeroRailToIndex(e,t={}){const{smooth:a=!1,...r}=t;focusHeroRailIndex(e,{...r,smooth:a})}function spawnFloatingLogos(e=state.currentCategory){const t=document.getElementById("heroDynamicBg");if(!t)return;t.innerHTML="",Array.isArray(spawnFloatingLogos._highlightTimers)&&spawnFloatingLogos._highlightTimers.forEach(e=>clearTimeout(e)),spawnFloatingLogos._highlightTimers=[];const a=e=>{for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e},r=[...getRandomCharacterImages(),...getCompanyCharacterImages(),...getCrimeCharacterImages(),...getCrimeShuffleImages()],n=a(r.slice());let o=0;const l=()=>{o>=n.length&&(a(n),o=0);const e=normalizeAssetPath(n[o++]);return{src:e,alt:getCharacterAltFromSrc(e)}},i=(e=!1,t=0)=>{const a=document.createElement("figure");a.className="bg-polaroid",e&&a.classList.add("bg-polaroid--highlight"),a.setAttribute("aria-hidden","true");const r=(6*Math.random()-3).toFixed(2),n=t.toFixed(2),o=(.95+.08*Math.random()).toFixed(2);a.style.setProperty("--bg-polaroid-tilt",`${r}deg`),a.style.setProperty("--bg-polaroid-offset",`${n}%`),a.style.setProperty("--bg-polaroid-scale",o);const i=document.createElement("img");i.className="bg-polaroid__image";let{src:s}=l();i.alt="",i.loading="lazy",i.decoding="async",i.setAttribute("aria-hidden","true");let c=0;return i.onerror=()=>{if(c<3){c++;const e=l();i.src=e.src}else a.style.display="none"},i.src=s,a.appendChild(i),a};[{modifier:"bg-polaroid-stripe--left",count:12,rotate:"-22deg",top:"-18%",left:"18%",zIndex:1,duration:"118s",delay:"0s",curve:-.6},{modifier:"bg-polaroid-stripe--center",count:14,rotate:"-18deg",duration:"112s",delay:"-24s",top:"-20%",left:"34%",zIndex:2,curve:0},{modifier:"bg-polaroid-stripe--right",count:13,rotate:"-21deg",duration:"126s",delay:"-32s",top:"-12%",left:"50%",zIndex:1,curve:1.8}].forEach((e,a)=>{const r=document.createElement("div");r.className=`bg-polaroid-stripe ${e.modifier}`,"string"==typeof e.top&&(r.style.top=e.top),"string"==typeof e.left&&(r.style.left=e.left),r.style.setProperty("--bg-stripe-rotate",e.rotate),r.style.zIndex=String(e.zIndex||0);const n=document.createElement("div");n.className="bg-polaroid-stripe__inner",n.style.setProperty("--bg-line-duration",e.duration),n.style.setProperty("--bg-line-delay",e.delay);const o=[];for(let t=0;t<e.count;t+=1){const r=1===a&&t%Math.ceil(e.count/4)===0,n=(e.count-1)/2,l=e.curve?(t-n)*e.curve:0;o.push(i(r,l))}o.forEach(e=>n.appendChild(e)),o.forEach(e=>n.appendChild(e.cloneNode(!0))),r.appendChild(n),t.appendChild(r);const l=e=>{const t=4e3+9e3*Math.random(),a=setTimeout(()=>{const t=Array.from(e.querySelectorAll(".bg-polaroid"));if(0===t.length)return void l(e);t.forEach(e=>e.classList.remove("bg-polaroid--pulse"));const a=t[Math.floor(Math.random()*t.length)];a.classList.add("bg-polaroid--pulse");const r=setTimeout(()=>{a.classList.remove("bg-polaroid--pulse")},5200);spawnFloatingLogos._highlightTimers.push(r),l(e)},t);spawnFloatingLogos._highlightTimers.push(a)};l(r)}),spawnFloatingLogos._resizeBound||(window.addEventListener("resize",debounce(()=>{"regelwerk"!==state.currentCategory&&"whitelist"!==state.currentCategory&&"legal"!==state.currentCategory&&"illegal"!==state.currentCategory||spawnFloatingLogos(state.currentCategory)},500)),spawnFloatingLogos._resizeBound=!0)}function handleCardTiltMove(e){document.querySelectorAll(".hero-card, .detail-hero-card").forEach(t=>{const a=t.getBoundingClientRect();if(!(e.clientX>=a.left&&e.clientX<=a.right&&e.clientY>=a.top&&e.clientY<=a.bottom))return;const r=a.left+a.width/2,n=a.top+a.height/2,o=(e.clientX-r)/a.width,l=(e.clientY-n)/a.height,i=t.closest(".hero-card-stack"),s=i&&i.classList.contains("as-rail")?4:8;t.style.setProperty("--tiltY",`${(-o*s).toFixed(2)}deg`),t.style.setProperty("--tiltX",`${(l*s).toFixed(2)}deg`)})}function resetCardTilt(e){const t=e?.target;if(t&&t.classList&&(t.classList.contains("hero-card")||t.classList.contains("detail-hero-card")))return t.style.setProperty("--tiltX","0deg"),void t.style.setProperty("--tiltY","0deg");document.querySelectorAll(".hero-card, .detail-hero-card").forEach(e=>{e.style.setProperty("--tiltX","0deg"),e.style.setProperty("--tiltY","0deg")})}function openDetail(e,t){const a=CATEGORY_CONFIG[e];if(!a)return;const r=a.getDataset();if(!r||0===r.length)return;const n=Math.max(0,Math.min(r.length-1,t)),o=r[n];if(!o)return;if(o.placeholder)return;state.currentCategory=e,state.currentIndex=n;const l=document.getElementById("detailDynamicBg");if(l){const t=a.getMedia(o),r=t&&"video"===t.type&&t.youtubeId;"illegal"===e?(l.querySelectorAll(".overlay-container, .police-light").forEach(e=>e.remove()),r||(spawnFogEffect(l),spawnCrimeDamage(l)),spawnDetailFlyingLogos(l,"illegal")):"regelwerk"===e||"whitelist"===e?(l.querySelectorAll(".overlay-container, .detail-flying-logo").forEach(e=>e.remove()),spawnDetailPolaroids(l)):(l.querySelectorAll(".overlay-container").forEach(e=>e.remove()),spawnDetailFlyingLogos(l))}const i=document.getElementById("detailOverlay")||document.querySelector(".crime-detail");i&&(i.setAttribute("data-category",e),"illegal"===e?i.classList.add("is-illegal"):i.classList.remove("is-illegal")),renderDetail(o,e),updateDetailNav(),showDetailOverlay(),highlightHeroCard(n)}function renderDetail(e,t){const a=CATEGORY_CONFIG[t];if(!a)return;const r=document.getElementById("detailTitle"),n=document.getElementById("detailTagline"),o=document.querySelector("#detailContent .content-text-body"),l=document.getElementById("detailCompanyLogo");if(r&&(r.textContent=a.getTitle(e)),n){const t=a.getTagline(e);t?(n.textContent=t,n.style.display="block",setTimeout(()=>{scaleTaglineToFit(n)},100)):n.style.display="none"}if(o&&(o.innerHTML=formatParagraphs(a.getContent(e))),l)if("illegal"===t)l.style.display="none";else{const r=getHeroCardLogo(e,t);r?(l.src=r,l.alt=a.getTitle(e)+" Logo",l.decoding="async",l.loading="eager",l.fetchPriority="high",l.style.display="block"):l.style.display="none"}const i=document.getElementById("detailCharacter");if(i){let r;r="legal"===t?normalizeAssetPath(`public/company_characters/${e.id}_character.png`):"illegal"===t?normalizeAssetPath(`public/crime_characters/${e.id}_character.png`):getHeroCardImage(e,t),r?(i.src=r,i.alt=a.getTitle(e)+" Character",i.decoding="async",i.loading="eager",i.fetchPriority="high",i.style.display="block"):i.style.display="none"}renderDetailMedia(e,t);renderDetailCollage(a.buildCollage(e,t),e.id||a.getTitle(e),e,t);mountInlineHeroCard({category:t,heroImage:getHeroCardImage(e,t),heroLogo:getHeroCardLogo(e,t),title:CATEGORY_CONFIG[t].getTitle(e),tagline:CATEGORY_CONFIG[t].getTagline(e)})}function mountInlineHeroCard({category:e=state.currentCategory,heroImage:t="",heroLogo:a="",title:r="",tagline:n=""}={}){const o=document.querySelector(".crime-detail-left");if(!o)return;const l=document.getElementById("detailMedia");if(!l)return;let i=o.querySelector(".detail-media-row");if(!i){i=document.createElement("div"),i.className="detail-media-row";const e=l.parentElement||o;e&&e.insertBefore(i,l),i.appendChild(l)}const s=i.querySelector(".detail-inline-hero");s&&s.remove();const c=document.createElement("article");c.className=`detail-hero-card detail-hero-card--${"illegal"===e?"illegal":"legal"} detail-inline-hero`,c.dataset.category=e,i.appendChild(c)}function renderDetailMedia(e,t){const a=CATEGORY_CONFIG[t],r=a?.getMedia?.(e),n=document.getElementById("detailMedia");if(n&&(destroyDetailVideoPlayer(),n.innerHTML="",r))if("video"===r.type&&r.youtubeId)mountDetailVideoPlayer({youtubeId:r.youtubeId,title:a.getTitle(e),buyUrl:r.buyUrl||null,allVideos:r.allVideos||null,videoIndex:r.videoIndex||0});else if("image"===r.type&&r.src){const o=document.createElement("img");o.src=r.src,o.alt=r.alt||a.getTitle(e),o.loading="eager",o.decoding="async",o.fetchPriority="high";const l="regelwerk"===t||"whitelist"===t?"contain":"cover";o.style.cssText=`position:absolute;inset:0;width:100%;height:100%;object-fit:${l};object-position:center;`,"regelwerk"===t?o.classList.add("detail-media-image--regelwerk"):"whitelist"===t&&o.classList.add("detail-media-image--whitelist"),n.appendChild(o)}}function queueYouTubePlayerInit(e){if("function"!=typeof e)return;const t="undefined"!=typeof window&&window.YT&&"function"==typeof window.YT.Player;if(state.youtubeReady||t){state.youtubeReady=!0;try{e()}catch(e){console.warn("âš ï¸ Failed to initialise YouTube player:",e)}}else ensureYouTubeAPI(),state.youtubeInitQueue.push(e)}function ensureYouTubeAPI(){if("undefined"!=typeof window&&window.YT&&"function"==typeof window.YT.Player)return state.youtubeReady=!0,void processYouTubeQueue();if(!document.querySelector('script[src*="youtube.com/iframe_api"]')){const e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",e.async=!0,e.defer=!0,document.head.appendChild(e)}}function processYouTubeQueue(){if(!state.youtubeReady)return;const e=Array.isArray(state.youtubeInitQueue)?state.youtubeInitQueue.slice():[];state.youtubeInitQueue=[],e.forEach(e=>{if("function"==typeof e)try{e()}catch(e){console.warn("âš ï¸ Failed to initialise YouTube player:",e)}})}function destroyDetailVideoPlayer(){const e=state.detailVideo;if(e){if(e.hideTimer&&(clearTimeout(e.hideTimer),e.hideTimer=null),e.player&&"function"==typeof e.player.destroy)try{e.player.destroy()}catch(e){console.warn("âš ï¸ Failed to destroy YouTube player:",e)}if(e.controls){const{element:t,muteBtn:a,volumeSlider:r,onMute:n,onVolume:o}=e.controls;a&&n&&a.removeEventListener("click",n),r&&o&&r.removeEventListener("input",o),t&&t.parentElement===e.wrapper&&t.parentElement.removeChild(t)}e.playerHost&&e.playerHost.parentElement===e.wrapper&&e.wrapper.removeChild(e.playerHost),state.detailVideo=null}}function mountDetailVideoPlayer({youtubeId:e,title:t,buyUrl:a,allVideos:r=null,videoIndex:n=0}){const o=document.getElementById("detailMedia");if(!o||!e)return;const l=document.createElement("div");l.className="detail-video-player__host";const i=`detailVideoPlayer_${e}_${Math.random().toString(36).slice(2,9)}`;l.id=i,l.setAttribute("loading","eager"),o.appendChild(l);const s=buildDetailVideoControls(a,r,n);o.appendChild(s.element);let c=a;r&&r.length>n&&r[n]&&(c=r[n].buyUrl||a||null);const d={player:null,playerHost:l,wrapper:o,currentVideoId:e,currentTitle:t||"",buyUrl:c,allVideos:r||null,currentVideoIndex:n,hideTimer:null,handlers:null,controls:s,lastVolume:60,isMuted:!0,controlsShown:!1};if(state.detailVideo=d,wireDetailVideoControls(d),s.element._videoNav){const{prevBtn:e,nextBtn:t}=s.element._videoNav;e.addEventListener("click",()=>{d.allVideos&&d.allVideos.length>1&&d.currentVideoIndex>0&&switchDetailVideo(d,-1)}),t.addEventListener("click",()=>{d.allVideos&&d.allVideos.length>1&&d.currentVideoIndex<d.allVideos.length-1&&switchDetailVideo(d,1)})}queueYouTubePlayerInit(()=>{d.player=new YT.Player(i,{videoId:e,playerVars:{autoplay:1,controls:0,mute:1,loop:1,playlist:e,playsinline:1,rel:0,fs:0,modestbranding:1,disablekb:1,iv_load_policy:3,cc_load_policy:0,enablejsapi:1,origin:window.location.origin,quality:"highres"}}),updateDetailVideoUi(d,{muted:!0,volume:0})})}function switchDetailVideo(e,t){if(!e.allVideos||e.allVideos.length<=1)return;const a=e.currentVideoIndex+t;if(a<0||a>=e.allVideos.length)return;const r=e.allVideos[a];if(!r||!r.youtubeId)return;if(e.currentVideoIndex=a,e.currentVideoId=r.youtubeId,e.buyUrl=r.buyUrl||null,e.player)try{e.player.loadVideoById(r.youtubeId)}catch(e){console.warn("Failed to switch video:",e)}const n=e.controls?.element;if(n&&n._videoNav){const{prevBtn:t,nextBtn:r,counter:o}=n._videoNav;o&&(o.textContent=`${a+1} / ${e.allVideos.length}`);const l=e.allVideos?e.allVideos.length:1;t.disabled=l<=1||0===a,r.disabled=l<=1||a===l-1}const o=n?.querySelector(".video-buy-link");o&&(e.buyUrl?(o.href=e.buyUrl,o.style.display=""):o.style.display="none")}function createSVGIcon(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");let a;switch(t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("stroke-width","2"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-linejoin","round"),e){case"mute":a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("d","M11 5L6 9H2v6h4l5 4V5z"),t.appendChild(a);const e=document.createElementNS("http://www.w3.org/2000/svg","line");e.setAttribute("x1","23"),e.setAttribute("y1","9"),e.setAttribute("x2","17"),e.setAttribute("y2","15"),t.appendChild(e);const r=document.createElementNS("http://www.w3.org/2000/svg","line");r.setAttribute("x1","17"),r.setAttribute("y1","9"),r.setAttribute("x2","23"),r.setAttribute("y2","15"),t.appendChild(r);break;case"unmute":a=document.createElementNS("http://www.w3.org/2000/svg","path"),a.setAttribute("d","M11 5L6 9H2v6h4l5 4V5z"),t.appendChild(a);const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"),t.appendChild(n);break;case"video":a=document.createElementNS("http://www.w3.org/2000/svg","rect"),a.setAttribute("x","2"),a.setAttribute("y","6"),a.setAttribute("width","18"),a.setAttribute("height","12"),a.setAttribute("rx","2"),t.appendChild(a);const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d","m10 9 5 3-5 3V9z"),t.appendChild(o)}return t}function buildDetailVideoControls(e=null,t=null,a=0){const r=document.createElement("div");r.className="video-controls",r.id="detailVideoControls",r.setAttribute("role","group"),r.setAttribute("aria-label","Videosteuerung");const n=document.createElement("button");n.type="button",n.className="control-btn control-btn--mute",n.setAttribute("aria-label","Ton stummschalten");const o=document.createElement("span");o.className="control-btn__icon",o.setAttribute("aria-hidden","true"),o.appendChild(createSVGIcon("mute")),n.appendChild(o);const l=document.createElement("div");l.className="volume-control";const i=document.createElement("input");i.type="range",i.className="volume-slider",i.min="0",i.max="100",i.step="5",i.value="0",i.style.setProperty("--volume-percent","0%"),i.setAttribute("aria-label","LautstÃ¤rke"),l.append(i);const s=t&&Array.isArray(t)&&t.length>0?t.length:1,c=Math.max(0,Math.min(a,s-1)),d=document.createElement("button");d.type="button",d.className="video-nav-btn video-nav-btn--prev",d.setAttribute("aria-label","Vorheriges Video"),d.innerHTML='<span aria-hidden="true">â€¹</span>',d.disabled=s<=1||0===c;const u=document.createElement("div");u.className="video-counter",u.setAttribute("aria-label","Video-Anzahl");const h=document.createElement("span");h.className="video-counter__icon",h.appendChild(createSVGIcon("video"));const g=document.createElement("span");g.className="video-counter__text",g.textContent=`${c+1} / ${s}`,u.appendChild(h),u.appendChild(g);const m=document.createElement("button");m.type="button",m.className="video-nav-btn video-nav-btn--next",m.setAttribute("aria-label","NÃ¤chstes Video"),m.innerHTML='<span aria-hidden="true">â€º</span>',m.disabled=s<=1||c===s-1,r._videoNav={prevBtn:d,nextBtn:m,counter:u.querySelector(".video-counter__text")};const p=t&&t.length>a&&t[a]&&t[a].buyUrl||e;let f=null;if(p){f=document.createElement("div"),f.className="video-buy-link-wrapper";const e=document.createElement("a");e.href=p,e.target="_blank",e.rel="noopener noreferrer",e.className="video-buy-link",e.innerHTML='\n\t\t\t<span class="video-buy-link__icon">â¤ï¸</span>\n\t\t\t<span class="video-buy-link__text">We love this Creator</span>\n\t\t',f.appendChild(e)}const y=[n,l];return f&&y.push(f),y.push(d,u,m),r.append(...y),{element:r,muteBtn:n,muteIcon:o,volumeSlider:i,onMute:null,onVolume:null}}function wireDetailVideoControls(e){const{wrapper:t,controls:a}=e;if(!t||!a?.element)return;a.element.classList.add("is-visible");const r=()=>{const t=state.detailVideo?.player;if(t)if(t.isMuted()){const a=e.lastVolume>0?e.lastVolume:60;try{t.unMute(),t.setVolume(a)}catch{}updateDetailVideoUi(e,{muted:!1,volume:a})}else{try{e.lastVolume=t.getVolume(),t.mute()}catch{}updateDetailVideoUi(e,{muted:!0,volume:0})}},n=t=>{const a=Number.parseInt(t?.target?.value,10),r=Number.isFinite(a)?clamp(a,0,100):0,n=state.detailVideo?.player;if(e.lastVolume=r>0?r:e.lastVolume,t?.target&&t.target.style.setProperty("--volume-percent",`${r}%`),n){try{n.setVolume(r)}catch{}if(0===r){try{n.mute()}catch{}updateDetailVideoUi(e,{muted:!0,volume:0})}else{try{n.isMuted()&&n.unMute()}catch{}updateDetailVideoUi(e,{muted:!1,volume:r})}}else updateDetailVideoUi(e,{muted:0===r,volume:r})};a.muteBtn.addEventListener("click",r),a.volumeSlider.addEventListener("input",n),a.onMute=r,a.onVolume=n,e.handlers={},updateDetailVideoUi(e,{muted:!0,volume:0})}function updateDetailVideoUi(e,{muted:t,volume:a}={}){const{controls:r}=e;if(!r)return;if("number"==typeof a&&Number.isFinite(a)){const t=clamp(Math.round(a),0,100);r.volumeSlider&&(r.volumeSlider.value=String(t),r.volumeSlider.style.setProperty("--volume-percent",`${t}%`)),t>0&&(e.lastVolume=t)}const n="boolean"==typeof t?t:0===Number(r.volumeSlider?.value||0);r.muteIcon&&(r.muteIcon.innerHTML="",r.muteIcon.appendChild(createSVGIcon(n?"mute":"unmute"))),r.muteBtn&&(r.muteBtn.setAttribute("aria-label",n?"Ton einschalten":"Ton stummschalten"),r.muteBtn.dataset.state=n?"muted":"unmuted"),e.isMuted=n}function renderDetailCollage(e,t="",a=null,r=state.currentCategory){const n=document.getElementById("detailCollage");if(!n)return;n.innerHTML="",n.dataset.userModified="0",n.dataset.layoutMode="mirror",n.classList.remove("detail-polaroids"),n.classList.remove("detail-collage--scatter"),n.classList.add("detail-hero-mirror");const o=r||state.currentCategory,l=a?CATEGORY_CONFIG[o]?.getTitle(a):"",i=a?CATEGORY_CONFIG[o]?.getTagline(a):"",s=a?getHeroCardImage(a,o):"",c=a?getHeroCardLogo(a,o):"";spawnDetailHeroMirror(n,{category:o,heroImage:s||pickRandomCharacterImage(),heroLogo:c,title:l,tagline:i}),updateChoiceButtons(),requestAnimationFrame(()=>alignCollageToMedia())}window.onYouTubeIframeAPIReady=function(){state.youtubeReady=!0,processYouTubeQueue()};let resizeTimeout,collageRealignRaf=null;function queueCollageRealign(){collageRealignRaf&&cancelAnimationFrame(collageRealignRaf),collageRealignRaf=requestAnimationFrame(()=>{collageRealignRaf=null,alignCollageToMedia()})}function updateDetailNav(){const e=getDataset(state.currentCategory),t=document.getElementById("crimeDetailNav")||document.getElementById("crimeNav");if(!t)return;if(!e||e.length<=1)return void(t.hidden=!0);t.hidden=!1;const a=e.filter(e=>!e.placeholder).length,r=document.getElementById("crimeNavCounter"),n=document.getElementById("crimeNavNextTitle"),o=document.getElementById("crimeNavPrevTitle"),l=document.getElementById("crimePrev"),i=document.getElementById("crimeNext"),s=e[state.currentIndex];if(!s||s.placeholder){let t=0;for(let a=0;a<e.length&&(e[a].placeholder||(t++,!(a>=state.currentIndex)));a++);return void(r&&(r.textContent=`${t} / ${a}`))}let c=0;for(let t=0;t<=state.currentIndex;t++)e[t].placeholder||c++;const d=state.currentIndex;let u=(d+1)%e.length,h=0;for(;e[u]&&e[u].placeholder&&h<e.length;)u=(u+1)%e.length,h++;let g=(d-1+e.length)%e.length,m=0;for(;e[g]&&e[g].placeholder&&m<e.length;)g=(g-1+e.length)%e.length,m++;r&&(r.textContent=`${c} / ${a}`);const p=e[u]&&!e[u].placeholder?CATEGORY_CONFIG[state.currentCategory].getTitle(e[u]):"",f=e[g]&&!e[g].placeholder?CATEGORY_CONFIG[state.currentCategory].getTitle(e[g]):"",y=document.getElementById("crimeNavNextLogo");if(y)if("illegal"===state.currentCategory)y.style.display="none";else{const t=getHeroCardLogo(e[u],state.currentCategory);t?(y.src=t,y.alt=p+" Logo",y.loading="lazy",y.decoding="async",y.style.display="block"):y.style.display="none"}const v=document.getElementById("crimeNavPrevLogo");if(v)if("illegal"===state.currentCategory)v.style.display="none";else{const t=getHeroCardLogo(e[g],state.currentCategory);t?(v.src=t,v.alt=f+" Logo",v.loading="lazy",v.decoding="async",v.style.display="block"):v.style.display="none"}n&&(n.textContent=p||"â€”",n.style.display=p?"block":"none"),o&&(o.textContent=f||"â€”",o.style.display=f?"block":"none"),l&&(l.dataset.target=String(g)),i&&(i.dataset.target=String(u))}function navigateDetail(e=1){const t=getDataset(state.currentCategory);if(!t||0===t.length)return;let a=state.currentIndex,r=0;const n=t.length;do{if(a=(a+e+t.length)%t.length,r++,r>=n)break}while(t[a]&&t[a].placeholder&&r<n);t[a]&&!t[a].placeholder&&openDetail(state.currentCategory,a)}function showDetailOverlay(){const e=document.getElementById("detailOverlay");e&&(e.classList.add("active"),document.body.style.overflow="hidden",document.body.classList.add("is-detail-open"))}function closeDetail(e={}){const t=document.getElementById("detailOverlay");t&&(t.classList.contains("active")||e.force)&&(destroyDetailVideoPlayer(),clearHeroRandomSpin(),t.classList.remove("active"),document.body.style.overflow="",document.body.classList.remove("is-detail-open"),e.silent||highlightHeroCard(null),resetHeroRailIdle(),scheduleHeroRailSync(!0))}function isDetailOpen(){const e=document.getElementById("detailOverlay");return!!e&&e.classList.contains("active")}function highlightHeroCard(e){state.heroCardsMounted&&document.querySelectorAll(".hero-card").forEach(t=>{const a=Number(t.dataset.index),r=t.dataset.category,n=null!==e&&a===e&&r===state.currentCategory;t.classList.toggle("hero-card--active",n)})}function applyCollageLayout(e,t){if(!e)return;const a=Array.from(e.children);if(0===a.length)return;let r=t||COLLAGE_LAYOUTS[0];const n=r[r.length-1],o=a.length,l=Math.PI/180*137.5,i="1"===e.dataset.rightSideOnly;i&&(r=r.map(e=>({...e,x:Math.max(52,e.x)})));const s=i?54:-2,c=i?66:52,d=i?.5:2.45,u=[];a.forEach((e,t)=>{const a=r[t]||n,i=clamp(a.x,-40,160),h=clamp(a.y,-40,160),g=t+1,m=t*l,p=.35+.65*((t+.6)/(o+1.2)),f=Math.cos(.45*m)*(8+11*p),y=Math.sin(.45*m)*(6+9*p),v=1+.16*Math.sin(.7*m)+.12*Math.cos(1.1*m),b=1.16+.36*(Math.random()-.5),_=a.w*b,C=a.h*b,w=e.dataset.orientation||"square";let I=1.08,L=1.08;"portrait"===w?(I*=.74,L*=1.42):"landscape"===w?(I*=1.44,L*=.72):(I*=1.18,L*=1.18);const T=.88+.54*Math.random(),A=.9+.48*Math.random(),M="landscape"===w?28:44,E="portrait"===w?102:84,S=clamp(_*I*v*T,"portrait"===w?28:36,"landscape"===w?92:86),x=clamp(C*L*v*A,M,E),R=26+40*p,k=.78+.12*Math.sin(.55*m),$=c+Math.cos(m)*R*k+(i-40)*d+f,H=34+Math.sin(m)*R*.92+.28*(h-42)+y,P=100-S-18,z=100-x-18;let D=clamp($,s,P),F=clamp(H,0,z);const N={left:D,top:F,w:S,h:x};for(let e=0;e<32;e++){let e=!1;for(const t of u){const a=Math.min(N.left+N.w,t.left+t.w)-Math.max(N.left,t.left),r=Math.min(N.top+N.h,t.top+t.h)-Math.max(N.top,t.top);if(a>0&&r>0){if(a*r/Math.min(N.w*N.h,t.w*t.h)>.045){const a=N.left+N.w/2,r=N.top+N.h/2;let n=a-(t.left+t.w/2),o=r-(t.top+t.h/2);const l=Math.max(.01,Math.hypot(n,o));n/=l,o/=l;const i=9.4;N.left=clamp(N.left+n*i,s,P),N.top=clamp(N.top+o*i,0,z),e=!0}}}if(!e)break}D=N.left,F=N.top,u.push({...N});const q=26+54*p+10*Math.sin(m),B=(a.r??0)+2.8*Math.sin(m)+2.1*Math.cos(.45*m),V=23*g%16,O=.96+.12*p,G=clamp(D+4.2*(Math.random()-.5),s,P),Y=clamp(F+3.4*(Math.random()-.5),0,z);e.style.left=`calc(${G}% + 9%)`,e.style.top=`calc(${Y}% + 9%)`,e.style.width=`calc(${S}% - 18%)`,e.style.height=`calc(${x}% - 18%)`,e.style.setProperty("--thumb-rotate",`${B.toFixed(2)}deg`),e.style.setProperty("--thumb-depth",`${q.toFixed(2)}px`),e.style.setProperty("--thumb-glow",`${(.22+.18*p).toFixed(3)}`),e.style.setProperty("--thumb-saturation",`${O.toFixed(3)}`),e.style.setProperty("--thumb-hue",`${V.toFixed(2)}deg`),e.style.zIndex=String(20+Math.round(40*p))})}function alignCollageToMedia(){try{const e=document.getElementById("detailMedia"),t=document.getElementById("detailCollage"),a=document.querySelector(".crime-detail-right"),r=document.getElementById("detailContent"),n=document.getElementById("crimeNav")||document.querySelector(".hero-rail-controls");if(!(e&&t&&a&&r))return;if(window.matchMedia("(max-width: 1024px)").matches)return t.style.marginTop="",t.style.height="",t.style.minHeight="",t.style.maxHeight="",t.style.left="",t.style.width="",clearThumbnailHighlights(t),void Array.from(t.children).forEach(e=>{e.style.left="",e.style.top="",e.style.width="",e.style.height="",e.style.setProperty("--thumb-rotate","0deg")});const o=a.getBoundingClientRect(),l=e.getBoundingClientRect(),i=r.getBoundingClientRect(),s=n?.getBoundingClientRect(),c=Math.max(0,Math.round(l.top-o.top)),d=s?s.bottom:i.bottom,u=Math.max(520,Math.round(d-l.top));if(t.style.marginTop=`${c}px`,t.style.height=`${u}px`,t.style.minHeight=`${u}px`,t.style.maxHeight=`${u}px`,"1"!==t.dataset.userModified)if("scatter"===t.dataset.layoutMode){const e=parseInt(t.dataset.layoutIndex||"0",10)||0;applyCollageLayout(t,getRandomizedLayout(COLLAGE_LAYOUTS[e]))}else"polaroids"!==t.dataset.layoutMode&&"mirror"!==t.dataset.layoutMode||(t.style.position="relative")}catch(e){console.warn("âš ï¸ Collage alignment failed:",e)}}function spawnDetailHeroMirror(e,t={}){if(!e)return;e.innerHTML="",Array.isArray(e.__highlightTimers)&&e.__highlightTimers.forEach(e=>clearTimeout(e)),e.__highlightTimers=[];const{category:a=state.currentCategory}=t;e.dataset.category=a,e.classList.toggle("detail-hero-mirror--illegal","illegal"===a),e.classList.toggle("detail-hero-mirror--legal","illegal"!==a);const r=document.createElement("div");r.className="detail-hero-mirror__foreground",e.appendChild(r);const n=document.createElement("img");n.className="hero-logo",n.src="public/roots-roleplay.svg",n.alt="Roots Roleplay",n.loading="lazy",n.decoding="async",r.appendChild(n);const o=document.createElement("div");o.className="hero-left__content";const l=document.createElement("div");l.className="hero-choice",l.setAttribute("role","group"),l.setAttribute("aria-label","Aktionen");[{label:"Regelwerk",className:"hero-choice__btn--rules",dataset:{choice:"regelwerk"}},{label:"Whitelist",className:"hero-choice__btn--whitelist",dataset:{choice:"whitelist"}}].forEach(e=>{const t=document.createElement("button");t.type="button",t.className=`hero-choice__btn ${e.className}`.trim(),t.textContent=e.label,Object.keys(e.dataset).forEach(a=>{t.dataset[a]=e.dataset[a]}),wireChoiceButton(t,{autoOpenDetail:!1}),l.appendChild(t)}),o.appendChild(l),r.appendChild(o)}function spawnDetailFlyingLogos(e,t="legal"){if(!e)return;e.querySelectorAll(".detail-flying-logo").forEach(e=>e.remove());let a=[];if("illegal"===t){a=[13,14,15,16,17,18,19,20,21,22,23].map(e=>({id:`crime-logo-${e}`,src:normalizeAssetPath(`public/crime_logos/${e}.png`),alt:`Crime Logo ${e}`}))}else a=state.companies.filter(e=>e&&e.id&&!e.placeholder).map(e=>({id:e.id,src:normalizeAssetPath(`public/company/${e.id}.png`),alt:(e.displayName||e.title||e.id)+" Logo"}));if(0===a.length)return;const r=Math.min(a.length,8);shuffleArray([...a]).slice(0,r).forEach((t,a)=>{const r=document.createElement("img");r.className="detail-flying-logo",r.alt=t.alt,r.loading="eager",r.decoding="async",r.setAttribute("aria-hidden","true");const n=15+70*Math.random(),o=15+70*Math.random(),l=50+40*Math.random(),i=120+80*Math.random(),s=Math.random()>.5?1:-1;r.style.left=`${n}%`,r.style.top=`${o}%`,r.style.width=`${l}px`,r.style.height="auto",r.style.opacity="0.12",r.style.setProperty("--fly-duration",`${i}s`),r.style.setProperty("--fly-delay","0s"),r.style.setProperty("--fly-direction",s),r.style.transform="translateZ(0)",r.style.willChange="transform",e.appendChild(r),r.src=t.src,r.loading="lazy",r.decoding="async"})}function spawnPoliceLights(e){if(!e)return;e.querySelectorAll(".police-light").forEach(e=>e.remove());for(let t=0;t<8;t++){const a=document.createElement("div");a.className="police-light",a.setAttribute("aria-hidden","true");const r=100*Math.random(),n=100*Math.random(),o=200+300*Math.random(),l=t%2==0;a.style.left=`${r}%`,a.style.top=`${n}%`,a.style.width=`${o}px`,a.style.height=`${o}px`,a.classList.add(l?"police-light--red":"police-light--blue"),e.appendChild(a)}}function spawnRainEffect(e){if(!e)return;e.querySelectorAll(".rain-drop").forEach(e=>e.remove());let t=e.querySelector(".rain-container");t||(t=document.createElement("div"),t.className="rain-container",t.setAttribute("aria-hidden","true"),e.appendChild(t));for(let e=0;e<150;e++){const e=document.createElement("div");e.className="rain-drop",e.setAttribute("aria-hidden","true");const a=100*Math.random(),r=2*Math.random(),n=.5+.5*Math.random(),o=10+20*Math.random(),l=.3+.4*Math.random();e.style.left=`${a}%`,e.style.setProperty("--rain-delay",`${r}s`),e.style.setProperty("--rain-duration",`${n}s`),e.style.height=`${o}px`,e.style.opacity=l,t.appendChild(e)}}function spawnFogEffect(e){if(!e)return;e.querySelectorAll(".detail-flying-logo").forEach(e=>e.remove());e.querySelectorAll(".fog-layer").forEach(e=>e.remove());let t=e.querySelector(".fog-container");t||(t=document.createElement("div"),t.className="overlay-container fog-container",t.setAttribute("aria-hidden","true"),e.appendChild(t));for(let e=0;e<8;e++){const e=document.createElement("div");e.className="fog-layer",e.setAttribute("aria-hidden","true");const a=200+300*Math.random(),r=120*Math.random()-10,n=100*Math.random(),o=10*Math.random(),l=20+30*Math.random(),i=.15+.15*Math.random(),s=Math.random()>.5?1:-1;e.style.width=`${a}px`,e.style.height=`${a}px`,e.style.left=`${r}%`,e.style.top=`${n}%`,e.style.setProperty("--fog-delay",`${o}s`),e.style.setProperty("--fog-duration",`${l}s`),e.style.setProperty("--fog-direction",s),e.style.opacity=i,t.appendChild(e)}}function spawnCrimeDamage(e){if(!e)return;e.querySelectorAll(".crime-damage").forEach(e=>e.remove());let t=e.querySelector(".crime-damage-container");t||(t=document.createElement("div"),t.className="overlay-container crime-damage-container",t.setAttribute("aria-hidden","true"),e.appendChild(t));for(let e=0;e<6;e++){const e=document.createElement("div");e.className="crime-damage crime-damage--crack",e.setAttribute("aria-hidden","true");const a=50+150*Math.random(),r=360*Math.random(),n=100*Math.random(),o=100*Math.random(),l=.2+.3*Math.random();e.style.width=`${a}px`,e.style.left=`${n}%`,e.style.top=`${o}%`,e.style.transform=`translate(-50%, -50%) rotate(${r}deg)`,e.style.opacity=l,t.appendChild(e)}for(let e=0;e<4;e++){const e=document.createElement("div");e.className="crime-damage crime-damage--splatter",e.setAttribute("aria-hidden","true");const a=20+40*Math.random(),r=100*Math.random(),n=100*Math.random(),o=360*Math.random(),l=.15+.15*Math.random();e.style.width=`${a}px`,e.style.height=`${a}px`,e.style.left=`${r}%`,e.style.top=`${n}%`,e.style.transform=`translate(-50%, -50%) rotate(${o}deg)`,e.style.opacity=l,t.appendChild(e)}}function spawnDetailPolaroids(e){if(!e)return;e.innerHTML="";const t=shuffleArray([...getCrimeCharacterImages(),...getRandomCharacterImages()].slice());let a=0;const r=(e=!1,r=0)=>{const n=document.createElement("figure");n.className="bg-polaroid",e&&n.classList.add("bg-polaroid--highlight"),n.setAttribute("aria-hidden","true");const o=(6*Math.random()-3).toFixed(2),l=r.toFixed(2),i=(.95+.08*Math.random()).toFixed(2);n.style.setProperty("--bg-polaroid-tilt",`${o}deg`),n.style.setProperty("--bg-polaroid-offset",`${l}%`),n.style.setProperty("--bg-polaroid-scale",i);const s=document.createElement("img");s.className="bg-polaroid__image";const{src:c}=(()=>{a>=t.length&&(shuffleArray(t),a=0);const e=t[a++];return{src:e,alt:getCharacterAltFromSrc(e)}})();return s.src=c,s.alt="",s.loading="lazy",s.decoding="async",s.setAttribute("aria-hidden","true"),n.appendChild(s),n};[{modifier:"film-strip--one",count:9,angle:"10deg",duration:"96s",delay:"-12s",top:"-4%",shift:"-40px",curve:.7},{modifier:"film-strip--two",count:10,angle:"12deg",duration:"104s",delay:"-24s",top:"16%",shift:"-8px",curve:.9},{modifier:"film-strip--three",count:10,angle:"14deg",duration:"112s",delay:"-36s",top:"38%",shift:"26px",curve:1.1},{modifier:"film-strip--four",count:9,angle:"16deg",duration:"120s",delay:"-48s",top:"62%",shift:"60px",curve:1.3}].forEach((t,a)=>{const n=document.createElement("div");n.className=`bg-polaroid-stripe ${t.modifier}`,n.style.setProperty("--film-strip-angle",t.angle),"string"==typeof t.top&&(n.style.top=t.top),"string"==typeof t.shift&&n.style.setProperty("--film-strip-shift",t.shift);const o=document.createElement("div");o.className="bg-polaroid-stripe__inner",o.style.setProperty("--bg-line-duration",t.duration),o.style.setProperty("--bg-line-delay",t.delay);const l=[];for(let e=0;e<t.count;e+=1){const n=1===a&&e%Math.ceil(t.count/4)===0,o=(t.count-1)/2,i=t.curve?(e-o)*t.curve:0;l.push(r(n,i))}l.forEach(e=>o.appendChild(e)),l.forEach(e=>o.appendChild(e.cloneNode(!0))),n.appendChild(o),e.appendChild(n);const i=t=>{const a=4e3+9e3*Math.random(),r=setTimeout(()=>{const e=Array.from(t.querySelectorAll(".bg-polaroid"));if(0===e.length)return void i(t);e.forEach(e=>e.classList.remove("bg-polaroid--pulse"));const a=e[Math.floor(Math.random()*e.length)];a.classList.add("bg-polaroid--pulse"),setTimeout(()=>{a.classList.remove("bg-polaroid--pulse")},5200),i(t)},a);e.__highlightTimers=e.__highlightTimers||[],e.__highlightTimers.push(r)};i(n)})}function enableThumbnailDragging(e){e&&Array.from(e.children).forEach(e=>{e.style.touchAction="",e.style.userSelect="",e.style.cursor="",e.dataset.dragInit=""})}function classifyThumbnailOrientations(e){if(!e)return;const t=Array.from(e.querySelectorAll(".crime-thumbnail")),a=(e,t)=>{if(!t||!t.naturalWidth||!t.naturalHeight)return;const a=t.naturalWidth/t.naturalHeight;let r="square";a>=1.18?r="landscape":a<=.82&&(r="portrait"),e.dataset.orientation=r,queueCollageRealign()};t.forEach(e=>{const t=e.querySelector("img");t&&(t.complete&&t.naturalWidth&&t.naturalHeight?a(e,t):t.addEventListener("load",()=>a(e,t),{once:!0}))})}function handleThumbnailPointerDown(e,t){e.preventDefault(),e.stopPropagation()}function enableThumbnailManipulation(e){e&&Array.from(e.children).forEach(e=>{e.querySelectorAll(".thumb-handle").forEach(e=>e.remove());const t=e.querySelector(".thumb-indicator");t&&t.remove();const a=e.querySelector(".thumb-toolbar");a&&a.remove()})}function getSelectedThumbnail(e){return e.querySelector(".crime-thumbnail.thumb-selected")}function selectThumbnail(e,t){if(e&&t){Array.from(e.children).forEach(e=>{e!==t&&e.classList.remove("thumb-selected")}),t.classList.add("thumb-selected");try{t.focus()}catch{}placeFloatingInspector(e,t)}}function deselectThumbnail(e){if(!e)return;const t=getSelectedThumbnail(e);t&&t.classList.remove("thumb-selected"),removeFloatingInspector(e)}function enableThumbnailSelection(e){if(!e||"1"===e.dataset.selectionInit)return;e.dataset.selectionInit="1";const t=document.getElementById("detailOverlay");t&&t.addEventListener("pointerdown",t=>{t.target&&t.target.closest&&t.target.closest(".crime-thumbnail")||deselectThumbnail(e)})}function ensureFloatingInspector(e){let t=e.querySelector(".floating-inspector");if(!t){t=document.createElement("div"),t.className="floating-inspector",t.setAttribute("role","toolbar"),t.setAttribute("aria-label","Adjust card");const a=(e,t)=>{const a=document.createElement("button");return a.className="thumb-btn",a.type="button",a.title=t,a.textContent=e,a.setAttribute("aria-label",t),a.addEventListener("pointerdown",e=>{e.stopPropagation()}),a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation()}),a},r=a("â†º","Rotate -15Â°"),n=a("â†»","Rotate +15Â°"),o=a("âˆ’","Shrink 10%"),l=a("+","Grow 10%"),i=a("Reset","Reset rotation");t.append(r,n,o,l,i);const s=t=>{const a=getSelectedThumbnail(e);if(!a)return;const r=(parseFloat((getComputedStyle(a).getPropertyValue("--thumb-rotate")||"0deg").replace("deg",""))||0)+t;a.style.setProperty("--thumb-rotate",`${r}deg`),placeFloatingInspector(e,a)},c=t=>{const a=getSelectedThumbnail(e);if(!a)return;const r=e.getBoundingClientRect(),n=a.offsetWidth,o=a.offsetHeight;let l=Math.max(40,n*t),i=Math.max(40,o*t),s=l/r.width*100,c=i/r.height*100;s=Math.min(80,Math.max(16,s)),c=Math.min(80,Math.max(16,c));const d="1"===e.dataset.rightSideOnly?55:0,u=Math.min(100-s,Math.max(d,a.offsetLeft/r.width*100)),h=Math.min(100-c,Math.max(0,a.offsetTop/r.height*100));a.style.left=`${u}%`,a.style.top=`${h}%`,a.style.width=`${s}%`,a.style.height=`${c}%`,placeFloatingInspector(e,a)};r.addEventListener("click",()=>s(-15)),n.addEventListener("click",()=>s(15)),i.addEventListener("click",()=>{const t=getSelectedThumbnail(e);t&&(t.style.setProperty("--thumb-rotate","0deg"),placeFloatingInspector(e,t))}),o.addEventListener("click",()=>c(.9)),l.addEventListener("click",()=>c(1.1)),t.addEventListener("pointerdown",e=>{e.stopPropagation()}),t.addEventListener("mouseenter",()=>{t.__hideTimer&&(clearTimeout(t.__hideTimer),t.__hideTimer=null),t.classList.remove("fade-out")}),t.addEventListener("mouseleave",()=>{t.__hideTimer&&clearTimeout(t.__hideTimer),t.__hideTimer=setTimeout(()=>{t.matches(":hover")||(t.classList.add("fade-out"),setTimeout(()=>{t.classList.remove("show","fade-out"),e.classList.remove("has-floating-inspector")},180))},2600)}),e.appendChild(t)}return t}function placeFloatingInspector(e,t){if(e&&"1"!==e.dataset.inspectorEnabled)return;const a=ensureFloatingInspector(e);if(!t)return a.classList.remove("show"),void e.classList.remove("has-floating-inspector");a.classList.remove("fade-out"),a.classList.add("show"),e.classList.add("has-floating-inspector");const r=a.style.visibility;a.style.display;a.style.visibility="hidden",a.style.display="flex";const n=a.offsetWidth,o=a.offsetHeight;a.style.visibility=r,a.style.display="";const l=10,i=e.clientWidth,s=e.clientHeight,c=t.offsetLeft,d=t.offsetTop,u=t.offsetWidth,h=t.offsetHeight;let g,m;i-(c+u)-l>=n?(g=c+u+l,m=d+h/2-o/2):c-l>=n?(g=c-n-l,m=d+h/2-o/2):d-l>=o?(g=c+u/2-n/2,m=d-o-l):(g=c+u/2-n/2,m=d+h+l),g=Math.max(l,Math.min(i-n-l,g)),m=Math.max(l,Math.min(s-o-l,m)),a.style.left=`${g}px`,a.style.top=`${m}px`,a.__hideTimer&&clearTimeout(a.__hideTimer),a.__hideTimer=setTimeout(()=>{a.matches(":hover")||(a.classList.add("fade-out"),setTimeout(()=>{a.classList.remove("show","fade-out"),e.classList.remove("has-floating-inspector")},180))},2600)}function removeFloatingInspector(e){const t=e.querySelector(".floating-inspector");t&&(t.__hideTimer&&(clearTimeout(t.__hideTimer),t.__hideTimer=null),t.classList.remove("fade-out"),t.classList.remove("show")),e.classList.remove("has-floating-inspector")}function enableThumbnailWheelRotate(e){e&&"1"!==e.dataset.wheelInit&&(e.dataset.wheelInit="1",e.addEventListener("wheel",t=>{if(!isDetailOpen())return;const a=getSelectedThumbnail(e);if(!a)return;if(!(t.target&&a.contains(t.target)))return;t.preventDefault();const r=parseFloat((getComputedStyle(a).getPropertyValue("--thumb-rotate")||"0deg").replace("deg",""))||0,n=t.deltaY>0?-1:1,o=Math.max(1,Math.round(Math.abs(t.deltaY)/40));let l=r+n*(t.shiftKey?15:8)*o*(t.altKey?.5:1);t.shiftKey&&(l=15*Math.round(l/15)),a.style.setProperty("--thumb-rotate",`${l}deg`)},{passive:!1}))}function enableThumbnailKeyboard(e){if(!e||"1"===e.dataset.keyboardInit)return;e.dataset.keyboardInit="1";document.addEventListener("keydown",t=>{if(!isDetailOpen())return;const a=getSelectedThumbnail(e);if(!a)return;const r=e.getBoundingClientRect(),n=t.shiftKey?2.5:.8,o=t.altKey?.35:1,l="1"===e.dataset.rightSideOnly?55:0,i=a.offsetWidth/r.width*100,s=a.offsetHeight/r.height*100;let c=a.offsetLeft/r.width*100,d=a.offsetTop/r.height*100;const u=t.key;let h=!1;"ArrowLeft"===u?(c-=n*o,h=!0):"ArrowRight"===u?(c+=n*o,h=!0):"ArrowUp"===u?(d-=n*o,h=!0):"ArrowDown"===u?(d+=n*o,h=!0):"r"===u.toLowerCase()?(a.style.setProperty("--thumb-rotate","0deg"),h=!0):"escape"===u.toLowerCase()&&(deselectThumbnail(e),h=!0),h&&(u.startsWith("Arrow")||"r"===u.toLowerCase()||"escape"===u.toLowerCase())&&(t.preventDefault(),c=Math.max(l,Math.min(100-i,c)),d=Math.max(0,Math.min(100-s,d)),t.shiftKey&&(c=2*Math.round(c/2),d=2*Math.round(d/2)),a.style.left=`${c}%`,a.style.top=`${d}%`)})}function scheduleThumbnailHighlights(e,t=[]){if(!e)return;e.__highlightTimer&&clearTimeout(e.__highlightTimer);let a=0;const r=t.length;if(0===r)return;const n=()=>{if(!document.body.contains(e))return;t.forEach(e=>e.classList.remove("pulse-highlight"));const o=t[a%r];o&&o.classList.add("pulse-highlight"),a=(a+1)%r,e.__highlightTimer=setTimeout(n,2200)};e.__highlightTimer=setTimeout(n,1200)}function clearThumbnailHighlights(e){e&&(e.__highlightTimer&&(clearTimeout(e.__highlightTimer),e.__highlightTimer=null),Array.from(e.children).forEach(e=>e.classList.remove("pulse-highlight")))}function resetThumbnailIdleRestart(e){e&&e.__idleRestartTimer&&(clearTimeout(e.__idleRestartTimer),e.__idleRestartTimer=null)}function prepareThumbnailIdleRestart(e){e&&(resetThumbnailIdleRestart(e),e.__idleRestartTimer=setTimeout(()=>maybeRestartThumbnailHighlights(e),6e3))}function maybeRestartThumbnailHighlights(e){if(!e)return;scheduleThumbnailHighlights(e,Array.from(e.children))}function getBasePath(){if(void 0!==window.__BASE_PATH__)return window.__BASE_PATH__;return window.location.pathname.replace(/\/[^/]*\.html?$/,"").replace(/\/$/,"")||""}function normalizeAssetPath(e=""){if(!e)return"";if(/^https?:\/\//i.test(e))return e;const t=getBasePath(),a=document.querySelector("base[href]");if(t&&e.startsWith(t+"/"))return e.replace(/\/+/g,"/");if(a&&!e.startsWith("/")&&!e.startsWith("./")&&!e.startsWith("../"))return e;const r=String(e).replace(/^\/+/,"");return t?`${t}/${r}`.replace(/\/+/g,"/"):`/${r}`.replace(/\/+/g,"/")}function debounce(e,t=300){let a=null;return(...r)=>{clearTimeout(a),a=setTimeout(()=>e(...r),t)}}function shuffleArray(e=[]){const t=Array.isArray(e)?e.slice():[];for(let e=t.length-1;e>0;e-=1){const a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t}function getDataset(e=state.currentCategory){return CATEGORY_CONFIG[e]?.getDataset?.()||[]}function getHeroCardImage(e,t){if(e&&e.placeholder)return normalizeAssetPath(e.image||"public/character_2.png");if("legal"===t)return normalizeAssetPath(`public/company_characters/${e.id}_character.png`);if("illegal"===t)return e.image?normalizeAssetPath(e.image):normalizeAssetPath(`public/crime/crime_${e.id}.png`);if("regelwerk"===t)return normalizeAssetPath(e.image||"public/roots_nogo.png");const a=`public/crime/${e.id}.png`;return normalizeAssetPath(e.image||a)}function ensureAbsolutePathForCSS(e){if(!e)return"";if(/^https?:\/\//i.test(e))return e;if(e.startsWith("/"))return e;const t=getBasePath(),a=normalizeAssetPath(e);return a.startsWith("/")?a:t?`${t}/${a}`:`/${a}`}function getHeroCardLogo(e,t){if(e?.placeholder)return"";let a="";return a="legal"===t?`public/company/${e.id}.png`:e.badge||e.image||"",a?ensureAbsolutePathForCSS(a):""}function getLayoutIndex(e=""){const t=e||"";let a=0;for(let e=0;e<t.length;e+=1)a+=t.charCodeAt(e);return a%COLLAGE_LAYOUTS.length}function escapeHtml(e=""){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function formatParagraphs(e=""){const t=e.trim();if(!t)return"";return`<p>${escapeHtml(t.replace(/\n{2,}/g," ").replace(/\n/g," ").replace(/\s+/g," ").trim())}</p>`}function createCollageItem(e,t,a){if(!e)return null;if(e.placeholder)return null;const r=e.id||e.slug||e.displayName||e.title;if(!r)return null;const n=CATEGORY_CONFIG[t]?.getTitle?.(e)||r;return{key:`${t}:${r}`,id:r,category:t,index:a,title:n,alt:n,image:getHeroCardImage(e,t),logo:getHeroCardLogo(e,t)}}function buildCategoryCollage(e,t){const a=getDataset(t),r=Array.isArray(a)?a:[],n=r.findIndex(t=>t?.id===e?.id),o=n>=0?createCollageItem(r[n],t,n):null;return buildSharedCollageItemsFromDataset({dataset:r,category:t,excludeKey:o?.key||null,limit:MAX_COLLAGE_ITEMS}).slice(0,MAX_COLLAGE_ITEMS)}function buildCompanyCollage(e){return buildCategoryCollage(e,"legal")}function buildCrimeCollage(e){return buildCategoryCollage(e,"illegal")}function buildRegelwerkCollage(e){return buildCategoryCollage(e,"regelwerk")}function buildWhitelistCollage(e){return buildCategoryCollage(e,"whitelist")}function buildSharedCollageItemsFromDataset({dataset:e=[],category:t,excludeKey:a=null,limit:r=MAX_COLLAGE_ITEMS}={}){const n=[],o=new Set;return a&&o.add(a),Array.isArray(e)?(e.forEach((e,a)=>{const r=createCollageItem(e,t,a);r&&(o.has(r.key)||(o.add(r.key),n.push(r)))}),shuffleArray(n).slice(0,r)):n}function clamp(e,t,a){return Math.min(a,Math.max(t,e))}function lerp(e,t,a){return e+(t-e)*a}function parseCompanyTitleParts(e="",t=""){const a=String(e||"").trim();if(!a)return{titleMain:"",tagline:"",fallback:t};const r=a.split(/\s[â€“-]\s/);return r.length>=2?{titleMain:r[0].trim(),tagline:r.slice(1).join(" - ").trim(),fallback:t}:{titleMain:a,tagline:"",fallback:t}}function scaleTaglineToFit(e){if(!e)return;const t=e.closest(".content-text");if(!t)return;const a=t.clientWidth-80-20;if(e.style.fontSize="22px",e.scrollWidth<=a)return void(e.style.fontSize="");let r=10,n=22,o=10;for(let t=0;t<20;t++){const t=(r+n)/2;e.style.fontSize=`${t}px`,e.scrollWidth<=a?(o=t,r=t+.5):n=t-.5}e.style.fontSize=`${o}px`}function autoSizeTextToFit(e){if(!e)return;const t=e.closest(".hero-card"),a=e.closest(".hero-card__nogo-content");if(!t||!a)return;const r=e.previousElementSibling,n=r?r.offsetHeight:0,o=t.offsetHeight-n-(parseFloat(getComputedStyle(a).paddingTop)+parseFloat(getComputedStyle(a).paddingBottom))-20;if(o<=0)return;if(e.style.fontSize="32px",e.style.overflow="visible",e.scrollHeight<=o)return void(e.style.fontSize="");let l=16,i=32,s=16;for(let t=0;t<25;t++){const t=(l+i)/2;e.style.fontSize=`${t}px`;e.scrollHeight<=o?(s=t,l=t+.3):i=t-.3}e.style.fontSize=`${s}px`,e.style.overflow="visible"}function handleResize(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout(()=>{const e=document.getElementById("detailTagline");if(e&&"none"!==e.style.display&&scaleTaglineToFit(e),"regelwerk"===state.currentCategory||"whitelist"===state.currentCategory){document.querySelectorAll(".hero-card--regelwerk .hero-card__nogo-description, .hero-card--whitelist .hero-card__nogo-description").forEach(e=>autoSizeTextToFit(e))}},150)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init();